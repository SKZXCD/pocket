"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[884],{8859:function(e,t,i){i(2762),i(2953),i(3296),i(7208),i(8408);class s{constructor(e,t,i,s){this.selectAllElement=e,this.checkBoxesSelector=t,this.submitBtnSelector=i,this.scopeSelector=s,this.onChange=this.onChange.bind(this);const n=document.querySelector(this.submitBtnSelector);n&&(n.disabled=!0),document.querySelector(this.scopeSelector).addEventListener("change",(e=>{e.target.matches(this.checkBoxesSelector)&&(document.querySelector(this.submitBtnSelector).disabled=!document.querySelector("".concat(this.checkBoxesSelector,":checked")))})),this.selectAllElement.addEventListener("change",this.onChange)}onChange(){const{checked:e}=this.selectAllElement;document.querySelectorAll(this.checkBoxesSelector).forEach((t=>{t.checked=e,document.querySelector(this.submitBtnSelector).disabled=!e}))}}class n{constructor(e){this.checkbox=e.querySelectorAll("input"),this.onClick=this.onClick.bind(this),this.targets=document.querySelector("#sign_targets"),this.choices=Array.from(this.targets.getElementsByTagName("input"));for(let e=0;e<this.checkbox.length;e++)this.checkbox[e].addEventListener("click",(()=>this.onClick(this.checkbox[e])))}onClick(e){const t=e.getAttribute("data-childs").split(";");for(let i=0;i<this.choices.length;i++)t.includes(this.choices[i].value)&&(e.checked?this.choices[i].checked=!0:this.choices[i].checked=!1)}}class o{constructor(e,t){this.buttons=Array.from(e.getElementsByTagName("button")),this.choices=Array.from(t.getElementsByTagName("input")),this.broadcast=document.querySelector("#broadcast-target"),this.broadcastList=Array.from(this.broadcast.getElementsByTagName("input")),this.check=this.check.bind(this),this.unCheck=this.unCheck.bind(this),this.onCheck=this.onCheck.bind(this),this.buttons.forEach((e=>e.addEventListener("click",this.onCheck)))}onCheck(e){switch(e.target.getAttribute("data-check")){case"check-all":this.choices.forEach(this.check);break;case"uncheck-all":this.choices.forEach(this.unCheck),this.broadcastList.forEach(this.unCheck)}}check(e){e.checked=!0}unCheck(e){e.checked=!1}}var a=i(4692),r=i.n(a);class l{constructor(e){this.inputTitle=e.querySelector("[data-broadcast-name-target]"),this.choices=e.querySelectorAll('input[type="checkbox"]'),this.buttonSave=e.querySelector("#broadcast_clique"),this.form=document.querySelector("#broadcast-form-target"),this.buttonCreate=document.querySelector("#create-broadcast"),this.buttonsEdit=document.querySelectorAll("#broadcast_list_edit"),this.buttonDelete=e.querySelector("#delete"),this.countEntityMessage=document.querySelector(".count-entity"),this.textError=e.querySelector("#error"),this.isCreate=null,this.resetModal=this.resetModal.bind(this),this.openCreateModal=this.openCreateModal.bind(this),this.openEditModal=this.openEditModal.bind(this),this.editBroadcast=this.editBroadcast.bind(this),this.addNewBroadcast=this.addNewBroadcast.bind(this),this.deleteBroadcast=this.deleteBroadcast.bind(this),this.changeEntityMessage=this.changeEntityMessage.bind(this),this.checkLength=this.checkLength.bind(this),this.isCreation=this.isCreation.bind(this),this.closeModal=this.closeModal.bind(this),this.checkValue=this.checkValue.bind(this),this.init()}init(){this.inputTitle.addEventListener("keyup",(e=>{this.inputTitle.value=this.checkLength(e.target.value)})),this.buttonCreate.addEventListener("click",this.openCreateModal),this.buttonsEdit.forEach((e=>e.addEventListener("click",(()=>this.openEditModal(e))))),this.choices.forEach((e=>e.addEventListener("click",this.changeEntityMessage)))}openCreateModal(){this.resetModal(),this.buttonDelete.classList.add("d-none"),this.isCreate=!0,this.isCreation()}openEditModal(e){this.buttonDelete.classList.remove("d-none"),this.isCreate=!1,this.isCreation(),this.resetModal(),this.inputTitle.value=e.getAttribute("data-broadcast-name");const t=e.getAttribute("data-broadcast-childs").split(";");this.choices.forEach((e=>e.checked=t.includes(e.value))),this.buttonSave.setAttribute("data-current-id",e.getAttribute("data-broadcast-id")),this.buttonDelete.setAttribute("data-current-id",e.getAttribute("data-broadcast-id")),this.buttonDelete.addEventListener("click",this.deleteBroadcast),t.length>1?this.countEntityMessage.innerHTML=t.length+" entités séléctionnées":this.countEntityMessage.innerHTML=t.length+" entité séléctionnée"}addNewBroadcast(){this.buttonSave.setAttribute("disabled",!0);const e=document.getElementsByName("modal")[0].getAttribute("aria-labelledBy"),t=new FormData(this.form),i=this.checkValue(t);if(i.error)this.textError.innerHTML='<div class="error">'.concat(i.message,"</div>"),this.buttonSave.removeAttribute("disabled");else{const i={method:"post",body:t};fetch("/admin/".concat(e,"/broadcast/create"),i).then((e=>e.json())).then((i=>{this.allBroadcastList=document.querySelector(".form-control-choice"),this.broadcastList='\n                <div class="form-check">\n                    <input type="checkbox" data-childs="'.concat(t.getAll("broadcast[childs][]").join(";"),'">\n                    <div id="broadcast_name">').concat(t.get("broadcast[name]"),'</div>\n                    <div id="broadcast-childs-number">(').concat(t.getAll("broadcast[childs][]").length,')</div>\n                    <button type="button" data-toggle="modal" data-target="#entity').concat(e,'" id="broadcast_list_edit" data-broadcast-id="').concat(i.id,'" data-broadcast-name="').concat(t.get("broadcast[name]"),'"\n                        data-broadcast-childs="').concat(t.getAll("broadcast[childs][]").join(";"),'" class="btn d-none d-md-block"\n                    >\n                        <i class="fas fa-pencil-alt">\n                        </i>\n                    </button>\n                </div>'),this.allBroadcastList.querySelector(".form-check")?this.allBroadcastList.innerHTML=this.allBroadcastList.innerHTML+this.broadcastList:this.allBroadcastList.innerHTML=this.broadcastList,this.buttonsEdit=this.allBroadcastList.querySelectorAll("button"),this.buttonsEdit.forEach((e=>e.addEventListener("click",(()=>this.openEditModal(e))))),new n(document.querySelector("#broadcast-target")),new o(document.querySelector("[data-target-toolbar]"),document.getElementById(document.querySelector("[data-target-toolbar]").getAttribute("data-target-toolbar"))),this.closeModal()})).catch((e=>{throw e}))}}editBroadcast(e){this.buttonSave.setAttribute("disabled",!0),this.buttonDelete.setAttribute("disabled",!0);const t=document.getElementsByName("modal")[0].getAttribute("aria-labelledBy"),i=new FormData(this.form),s=e.srcElement.getAttribute("data-current-id"),n=this.checkValue(i);if(n.error)this.textError.innerHTML='<div class="error">'.concat(n.message,"</div>"),this.buttonSave.removeAttribute("disabled"),this.buttonDelete.removeAttribute("disabled");else{const e={method:"post",body:i};fetch("/admin/".concat(t,"/broadcast/").concat(s,"/edit"),e).then((()=>{const e=document.querySelector('button[data-broadcast-id="'.concat(s,'"]')).parentNode,t=e.querySelector("button"),n=e.querySelector("#broadcast-childs-number"),o=e.querySelector("input"),a=e.querySelector("#broadcast_name"),r=i.getAll("broadcast[childs][]").join(";");a.innerHTML=i.get("broadcast[name]"),n.innerHTML="(".concat(i.getAll("broadcast[childs][]").length,")"),o.setAttribute("data-childs",r),t.setAttribute("data-broadcast-name",i.get("broadcast[name]")),t.setAttribute("data-broadcast-childs",r),this.closeModal()})).catch((e=>{throw e}))}}checkLength(e){return e.length>30?e.slice(0,30):e}deleteBroadcast(e){this.confirm=confirm(this.buttonDelete.getAttribute("data-confirm"));const t=document.getElementsByName("modal")[0].getAttribute("aria-labelledBy"),i=new FormData(this.form),s=e.srcElement.getAttribute("data-current-id"),n={method:"post",body:i};this.confirm&&(this.buttonSave.setAttribute("disabled",!0),this.buttonDelete.setAttribute("disabled",!0),fetch("/admin/".concat(t,"/broadcast/").concat(s,"/delete"),n).then((e=>{if(e.ok){document.querySelector('button[data-broadcast-id="'.concat(s,'"]')).parentNode.remove();const e=document.querySelector(".form-control-choice");0==e.children.length&&(e.innerHTML="Vous n'avez encore aucune liste de diffusion")}}))),this.closeModal()}resetModal(){this.inputTitle.value="",this.textError.innerHTML="",this.choices.forEach((e=>e.checked=!1)),this.buttonSave.removeAttribute("data-current-id"),this.changeEntityMessage(),this.buttonDelete.removeAttribute("disabled"),this.buttonSave.removeAttribute("disabled")}changeEntityMessage(){let e=0;this.choices.forEach((t=>{t.checked&&(e+=1)})),this.countEntityMessage.innerHTML=e>1?e+" entités séléctionnées":e+" entité séléctionnée"}isCreation(){this.isCreate?(this.buttonSave.removeEventListener("click",this.editBroadcast),this.buttonSave.addEventListener("click",this.addNewBroadcast)):(this.buttonSave.removeEventListener("click",this.addNewBroadcast),this.buttonSave.addEventListener("click",this.editBroadcast))}closeModal(){const e=document.querySelector(".modal-broadcast");r()(e).modal("hide")}checkValue(e){return""===e.get("broadcast[name]")?{error:!0,message:"Le nom de la liste ne peut pas etre vide"}:0===e.getAll("broadcast[childs][]").length?{error:!0,message:"vous n'avez pas selectionner de commune enfant"}:{error:!1}}}class d{constructor(e,t){this.container=e,this.editor=t,this.container.addEventListener("change",(()=>{this.changeBackground()})),this.changeBackground()}changeBackground(){let e=this.getImage();null!==e&&(e="url(".concat(e,")")),this.editor.style.backgroundImage=e}getImage(){return this.container.options[this.container.selectedIndex].getAttribute("data-image")||null}}var c=i(6440),h=i(937),u=i(437),m=i(4089),p=i(6611),g=i(1888),f=i(9094),y=i(5152),b=i(7863),v=i(2270),w=i(2736),S=i(8550),E=i(5617),A=i(3056),L=i(6176),q=i(745);class C{constructor(e,t,i,s){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];this.data=s.map((e=>({...e,totalView:e.nbView+e.nbViewEmbed}))),this.counter=t,this.noViews=i,this.end=e.getAttribute("data-last-date"),this.start=e.getAttribute("data-first-date"),this.isEntityStat=e.getAttribute("data-entity"),this.root=c.b.new(e.id),this.root.locale=L.A,this.chart=this.root.container.children.push(g.C.new(this.root,{panX:!1,panY:!1,wheelX:"none",wheelY:"none",maxTooltipDistance:-1})),this.chart.get("colors").set("colors",[(0,h.yW)(40703),(0,h.yW)(16742448)]);if(this.chart.set("cursor",f.A.new(this.root,{behavior:"zoomX"})).lineY.set("visible",!1),!this.end||new Date(this.end)>=new Date?(this.end=new Date,this.end.setDate(this.end.getDate()+1)):(this.end=new Date(this.end),this.end.setDate(this.end.getDate()+1)),this.start&&(this.start=new Date(this.start)),0===this.data.length)for(let e=0;e<=10;e++)this.data.push({nbView:e});this.dateAxis=this.chart.xAxes.push(y.c.new(this.root,{renderer:b.j.new(this.root,{}),baseInterval:{timeUnit:"day",count:1},tooltip:u.m.new(this.root,{forceHidden:!0}),dateFormats:{day:"d MMM"},periodChangeDateFormats:{day:"d MMM"}})),this.dateAxis.data.setAll(this.data),this.addViewSeries(),o&&this.addFavorisSeries(),this.addScrollBar(),this.addLegend(),this.readyCallback=n,this.onReady=this.onReady.bind(this),this.root.events.on("frameended",this.onReady),this.dateAxis.set("max",this.end.getTime()),this.start&&this.dateAxis.set("min",this.start.getTime()),this.start=null,this.end=null,this.dateAxis.onPrivate("selectionMin",(e=>{this.start=new Date(e),this.dateChanged(this.start,this.end)})),this.dateAxis.onPrivate("selectionMax",(e=>{this.end=new Date(e),this.dateChanged(this.start,this.end)})),this.exportingPulgin=this.addExporting(),document.querySelector("[data-export-chart]")&&document.querySelector("[data-export-chart]").addEventListener("click",(e=>{this.exportingPulgin.download(e.target.dataset.exportChart)}))}addLegend(){const e=this.chart.bottomAxesContainer.children.push(m.s.new(this.root,{centerX:(0,p.KN)(50),x:(0,p.KN)(50),useDefaultMarker:!0}));e.data.setAll(this.chart.series.values),this.chart.series.each((t=>{"Nombre de super favoris"===t._settings.name&&(t._settings.fill=(0,h.yW)(2634890)),"totalView"===t.get("valueYField")&&e.data.removeValue(t)}))}addViewSeries(){this.viewAxis=this.chart.yAxes.push(v.F.new(this.root,{renderer:w.Q.new(this.root,{})}));const e=this.chart.series.push(S.k.new(this.root,{name:"Nombre de lectures sur l'appli",xAxis:this.dateAxis,yAxis:this.viewAxis,valueYField:"nbView",valueXField:"day",stacked:null!==this.isEntityStat}));if(this.addTooltip(e),e.data.setAll(this.data),e.appear(),null!==this.isEntityStat){const e=this.chart.series.push(S.k.new(this.root,{name:"Nombre de lectures sur Ordinateur",xAxis:this.dateAxis,yAxis:this.viewAxis,stacked:!0,valueYField:"nbViewEmbed",valueXField:"day",stroke:(0,h.yW)(8507386),fill:(0,h.yW)(8507386)}));this.addTooltip(e),e.data.setAll(this.data),e.appear();const t=this.chart.series.push(S.k.new(this.root,{name:"Nombre de lectures Total",xAxis:this.dateAxis,yAxis:this.viewAxis,valueYField:"totalView",valueXField:"day",stacked:!1,clustered:!1,stroke:(0,h.yW)(16777215),fill:(0,h.yW)(16777215)}));t.set("forceHidden",!0),this.addTooltip(t),t.data.setAll(this.data)}}addFavorisSeries(){const e=this.chart.series.push(E.I.new(this.root,{name:"Nombre de favoris",xAxis:this.dateAxis,yAxis:this.viewAxis,valueYField:"nbFavoris",valueXField:"day"}));e.strokes.template.setAll({strokeWidth:1.5}),this.addTooltip(e),e.data.setAll(this.data);const t=this.chart.series.push(E.I.new(this.root,{name:"Nombre de super favoris",xAxis:this.dateAxis,yAxis:this.viewAxis,valueYField:"nbFavorisAsPreferred",valueXField:"day",stroke:(0,h.yW)(2634890)}));t.strokes.template.setAll({strokeWidth:1.5}),this.addTooltip(t),t.data.setAll(this.data)}addScrollBar(){const e=A.U.new(this.root,{orientation:"horizontal",height:50});this.chart.set("scrollbarX",e),this.chart.bottomAxesContainer.children.push(e);const t=e.chart.xAxes.push(y.c.new(this.root,{groupData:!0,groupIntervals:[{timeUnit:"day",count:1}],baseInterval:{timeUnit:"day",count:1},renderer:b.j.new(this.root,{opposite:!1,strokeOpacity:0}),max:this.end.getTime(),min:this.start?this.start.getTime():this.data[0].day})),i=e.chart.yAxes.push(v.F.new(this.root,{renderer:w.Q.new(this.root,{})}));e.chart.series.push(S.k.new(this.root,{xAxis:t,yAxis:i,valueYField:"nbView",valueXField:"day"})).data.setAll(this.data)}addTooltip(e){const t=e.set("tooltip",u.m.new(this.root,{getFillFromSprite:!1,getStrokeFromSprite:!0,autoTextColor:!1,pointerOrientation:"horizontal"}));t.get("background").setAll({fill:(0,h.yW)(16777215)}),t.label.setAll({text:"[bold]{categoryX}[/]",fill:(0,h.yW)(0)}),t.label.adapters.add("text",(()=>{var t;const i=null===(t=e.get("tooltip"))||void 0===t?void 0:t.dataItem,s=null==i?void 0:i.dataContext,n=null==s?void 0:s.day,o=["[bold]"+this.formatFrenchDateTooltip(n)+"[/]"],a=[];return this.chart.series.each((e=>{"totalView"===e.get("valueYField")?o.push("[bold width:100px]".concat(e.get("name"),":[/] {").concat(e.get("valueYField"),"}")):a.push("[".concat(e.get("stroke").toString(),"]●[/] [bold width:100px]").concat(e.get("name"),":[/] {").concat(e.get("valueYField"),"}"))})),o.push(...a),o.join("\n")}))}addExporting(){let e={day:"Date",nbView:"Nombre de vues"};return this.data[0]&&void 0!==this.data[0].nbFavoris&&(e.nbFavoris="Nombre de favoris"),void 0!==this.data[0].nbFavorisAsPreferred&&(e.nbFavorisAsPreferred="Nombre de super favoris"),q.L.new(this.root,{filePrefix:"export_panneaupocket",dataSource:this.data,dataFields:e,dateFields:["day"],dateFormat:"dd-MM-yyyy"})}setDates(e,t){this.dateAxis.zoomToValues(e,t),this.dateChanged(e,t)}onReady(){this.root.events.off("frameended",this.onReady),this.readyCallback()}dateChanged(e,t){if(null===e||null===t)return;const i=this.getTotal(e.getTime(),t.getTime());if(null!==this.noViews){const e=this.counter.parentNode;0===i?(this.noViews.style.display="block",e.style.display="none"):(this.noViews.style.display="none",this.counter.innerText=i,e.style.display="block")}else this.counter.innerText=i}getTotal(e,t){return null!==this.isEntityStat?this.data.filter((i=>i.day>=e&&i.day<=t)).reduce(((e,t)=>e+t.nbView+t.nbViewEmbed),0):this.data.filter((i=>i.day>=e&&i.day<=t)).reduce(((e,t)=>e+t.nbView),0)}formatFrenchDateTooltip(e){let t=new Date(e).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"});return t=t.charAt(0).toUpperCase()+t.slice(1),t}}var x=i(9277),k=i(4436),M=i(3714),I=i(8690);class D{constructor(e){this.element=e,this.checkboxList=e.querySelectorAll("input[type=checkbox]"),this.onChange=this.onChange.bind(this),this.load()}addEventListener(e,t){this.element.addEventListener(e,t)}load(){this.checkboxList.forEach((e=>{e.addEventListener("change",this.onChange)}))}onChange(){const e=this.getCurrents();this.element.dispatchEvent(new CustomEvent("skill",{detail:{value:e}}))}getCurrents(){return Array.from(this.checkboxList).filter((e=>e.checked)).map((e=>e.value))}}class T{constructor(e){this.element=e,this.inputResidentMin=e.querySelector("input[type=number][id=resident-min]"),this.inputResidentMax=e.querySelector("input[type=number][id=resident-max]"),this.errorElementId="resident-selector-error",this.errorMessage=e.getAttribute("data-error-message"),this.onChange=this.onChange.bind(this),this.load()}addEventListener(e,t){this.element.addEventListener(e,t)}load(){this.inputResidentMin.addEventListener("change",this.onChange),this.inputResidentMax.addEventListener("change",this.onChange)}onChange(){const e=this.getCurrent();this.inputResidentMin.max=this.inputResidentMax.value,this.inputResidentMax.min=this.inputResidentMin.value,this.validate()?this.createErrorMessage():this.removeErrorMessage(),this.element.dispatchEvent(new CustomEvent("resident",{detail:{min:e.min,max:e.max}}))}validate(){return parseInt(this.inputResidentMax.value,10)<parseInt(this.inputResidentMin.value,10)}createErrorMessage(){if(this.element.querySelector("p[id=".concat(this.errorElementId,"]")))return;this.inputResidentMax.setCustomValidity("Une erreur");const e=document.createElement("p");e.setAttribute("id",this.errorElementId);const t=document.createTextNode(this.errorMessage);e.appendChild(t),this.element.appendChild(e)}removeErrorMessage(){const e=this.element.querySelector("p[id=".concat(this.errorElementId,"]"));e&&e.remove()}getCurrent(){var e,t;return{min:null!==(e=parseInt(this.inputResidentMin.value,10))&&void 0!==e?e:null,max:null!==(t=parseInt(this.inputResidentMax.value,10))&&void 0!==t?t:null}}}var B=i.p+"images/default-user-picture.97f51179.svg";class _{constructor(e){this.element=e,this.users=[],this.defaultPicture=B,this.setItems=this.setItems.bind(this),this.display=this.display.bind(this)}setItems(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.users=e,this.display(t)}display(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.element.innerHTML="",e||(0!==this.users.length?this.users.forEach((e=>this.element.insertAdjacentHTML("beforeend",this.getTemplate(e)))):this.element.insertAdjacentHTML("beforeend",this.getNoResultTemplate()))}getTemplate(e){var t,i,s,n,o,a,r,l;const d=e.skills.length>0?e.skills.map((e=>e.name)).join(", "):"-",c=null!==(t=e.picture)&&void 0!==t?t:this.defaultPicture;return'\n            <li class="user-card">\n                <div class="content">\n                    <div class="user__infos">\n                        <span class="image" style="background-image: url('.concat(c,')"></span>\n                        <div>\n                            <span class="name">').concat(e.firstname," ").concat(e.lastname,"</span>\n                            <span>").concat(null!==(i=e.profession)&&void 0!==i?i:"",'</span>\n                            <dl>\n                                <div class="definition-group definition-group--large">\n                                    <dt>Domaines de connaissance et/ou d\'intervention</dt>\n                                    <dd>').concat(d,'</dd>\n                                </div>\n                                <div class="definition-group">\n                                    <dt>Tel. fixe</dt>\n                                    <dd><a href="tel:').concat(null!==(s=e.phoneNumber)&&void 0!==s?s:"",'">').concat(null!==(n=e.phoneNumber)&&void 0!==n?n:"-",'</a></dd>\n                                </div>\n                                <div class="definition-group">\n                                    <dt>Tel. mobile</dt>\n                                    <dd><a href="tel:').concat(null!==(o=e.mobileNumber)&&void 0!==o?o:"",'">').concat(null!==(a=e.mobileNumber)&&void 0!==a?a:"-",'</a></dd>\n                                </div>\n                                <div class="definition-group">\n                                    <dt>E-mail</dt>\n                                    <dd><a href="mailto:').concat(null!==(r=e.email)&&void 0!==r?r:"",'">').concat(null!==(l=e.email)&&void 0!==l?l:"-",'</a></dd>\n                                </div>\n                            </dl>\n                        </div>\n                    </div>\n                    <ul class="entities-list">\n                        ').concat(e.entities.map(this.getEntityTemplate).join(""),"\n                    </ul>\n                </div>\n            </li>\n        ")}getEntityTemplate(e){const t=e.residentNumber?"<span> ".concat(e.residentNumber," habitants </span>"):"",i=e.website?'<a href="'.concat(e.website,'">').concat(e.website,"</a>"):"";return'\n            <li class="entities-list__item">\n                <img src='.concat(e.logo,' alt="">\n                <div class="content">\n                    <span class="title">').concat(e.name," (").concat(e.zipCode,")</span>\n                    ").concat(t,"\n                    ").concat(i,"\n                </div>\n            </li>\n        ")}getNoResultTemplate(){return'\n            <li class="user-card">\n                <div class="user__infos">\n                    Aucun résultat ne correspond à votre recherche\n                </div>\n            </li>\n        '}}class P{constructor(e,t,i,s,n,o,a,r,l){this.picture=e,this.firstname=t,this.lastname=i,this.profession=s,this.skills=null!=n?n:[],this.email=o,this.phoneNumber=a,this.mobileNumber=r,this.entities=l}}class F{constructor(){this.ROUTER={userDirectory:"/admin/api/directory/search"}}getUserDirectory(e,t,i){const s=JSON.stringify(e),n=new Headers({"Content-Type":"application/json","Content-length":s.length}),o=new Request(this.ROUTER.userDirectory,{body:s,headers:n,method:"POST"});fetch(o).then((e=>{if(200===e.status)return e.json();throw new Error("Something went wrong on api server!")})).then((e=>{t(e.map(this.parseUser))})).catch(i())}parseUser(e){const{picture:t,firstname:i,lastname:s,profession:n,skills:o,email:a,phoneNumber:r,mobileNumber:l,entities:d}=e;return new P(t,i,s,n,o,a,r,l,d)}}class N{constructor(e,t,i,s,n,o,a){this.props={country:null,region:null,department:null,entity:null,skills:[],resident:{min:null,max:null}},this.users=null,this.apiClient=new F,this.countrySelector=new I.A(t),this.regionSelector=new k.A(i),this.departmentSelector=new M.A(s),this.citySelector=new x.A(e),this.residentSelector=new T(o),this.skillSelector=new D(n),this.userList=new _(a),this.onCountry=this.onCountry.bind(this),this.onRegion=this.onRegion.bind(this),this.onDepartment=this.onDepartment.bind(this),this.onSelectCity=this.onSelectCity.bind(this),this.onResident=this.onResident.bind(this),this.onSkill=this.onSkill.bind(this),this.search=this.search.bind(this),this.loadUsers=this.loadUsers.bind(this),this.onError=this.onError.bind(this),this.regionSelector.addEventListener("region",this.onRegion),this.regionSelector.addEventListener("clear",this.onRegion),this.departmentSelector.addEventListener("department",this.onDepartment),this.departmentSelector.addEventListener("clear",this.onDepartment),this.countrySelector.addEventListener("country",this.onCountry),this.citySelector.addEventListener("city",this.onSelectCity),this.residentSelector.addEventListener("resident",this.onResident),this.skillSelector.addEventListener("skill",this.onSkill)}onSelectCity(e){this.props.entity=e.detail.id,this.search()}onCountry(e){this.regionSelector.setCountry(e.detail.id||null),this.departmentSelector.setCountry(e.detail.id||null),this.citySelector.setCountry(e.detail.id||null),this.props.country=e.detail.id||null,e.detail.id&&(this.citySelector.clear(),this.props.entity=null,this.regionSelector.clear(),this.departmentSelector.clear(),this.props.department=null),this.search()}onRegion(e){this.departmentSelector.setRegion(e.detail.id||null),this.citySelector.setRegion(e.detail.id||null),this.props.region=e.detail.id||null,e.detail.id&&(this.citySelector.clear(),this.props.entity=null,this.departmentSelector.clear(),this.props.department=null),this.search()}onDepartment(e){this.citySelector.setDepartment(e.detail.id||null),this.props.department=e.detail.id||null,e.detail.id&&(this.citySelector.clear(),this.props.entity=null),this.search()}onSkill(e){this.props.skills=e.detail.value||[],this.search()}onResident(e){this.props.resident.min=e.detail.min||null,this.props.resident.max=e.detail.max||null,this.search()}loadUsers(e){this.users=e,this.userList.setItems(this.users)}onError(){this.users=null,this.userList.setItems([])}reset(){this.users=null,this.userList.setItems([],!0)}search(){JSON.stringify(this.props)!==JSON.stringify({country:null,region:null,department:null,entity:null,skills:[],resident:{min:null,max:null}})?this.apiClient.getUserDirectory(this.props,this.loadUsers,this.onError):this.reset()}}i(5440),i(5458);var R=i(3022);class O{constructor(e){this.element=r()(e),this.rows=this.element.find("tbody"),this.index=this.rows.find("tr").length,this.rowPrototype=this.rows.data("prototype"),r()(e).on("click",".add-btn",(()=>{this.addRow()})),r()(e).on("click",".remove-btn",(e=>{const t=r()(e.currentTarget),i=t.data("confirm");confirm(i)&&t.closest("tr").remove()}))}addRow(){const e=this.rowPrototype.replace(/__name__/g,this.index);this.rows.append(e),new R.A(r()("tr:last-child .entity-field",this.element),!1),this.index+=1}}class H{constructor(e){this.container=e,this.generateLoader()}generateLoader(){let e=document.createElement("div");e.classList.add("loader"),e.innerHTML="<div></div><div></div><div></div><div></div>",this.container.append(e)}}class j{constructor(e){e.addEventListener("click",(e=>{e.preventDefault()}))}}class V{constructor(e){this.modal=e,this.idModal=this.modal.dataset.idModal,this.triggerClose=this.modal.querySelector("[data-trigger-close-modal]"),this.triggerModal=null,this.init()}init(){this.setupTriggerModal(),this.modal.addEventListener("click",(e=>{e.target===this.modal&&this.close()})),this.triggerClose.addEventListener("click",(e=>{e.preventDefault(),this.close()}))}setupTriggerModal(){this.triggerModal=document.querySelector('[data-trigger-modal="'.concat(this.idModal,'"]')),this.triggerModal&&this.triggerModal.addEventListener("click",(e=>{e.preventDefault(),this.open()}))}open(){this.modal.classList.add("active")}close(){this.modal.classList.remove("active")}}class U{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.targetInput=e.querySelector("input"),this.sourceInput=t,this.offset=i,this.length=s,this.onChange=this.onChange.bind(this),this.sourceInput.addEventListener("keyup",this.onChange)}onChange(){const e=this.sourceInput.value;this.targetInput.value=e.substring(this.offset,this.length>0?this.offset+this.length:e.length)}}class z{constructor(e){var t;this.containerSearchableField=e,this.originalSelect=this.containerSearchableField.querySelector("select"),this.originalOptionsSelect=this.originalSelect.querySelectorAll("option"),this.originalInput=this.containerSearchableField.querySelector("input"),this.inputSearch=null,this.containerOptions=null,this.options=null,this.chevron=null,this.setupContainer(),null!==(t=this.originalSelect.querySelector("option:checked"))&&void 0!==t&&t.value&&this.createDelatableAction(),this.originalInput&&(""!==this.originalInput.value&&(this.inputSearch.value=this.originalInput.value),this.filterParents=this.containerSearchableField.querySelector("#entity_filter_parents"),this.filterParents.style.display="none",this.inputSearch.style.position="relative"),this.setupEvents()}setupContainer(){this.createInputSearch(),this.createContainerOptions(),this.createChevron()}setupEvents(){this.inputSearch.addEventListener("click",(()=>{this.containerOptions.classList.add("active"),this.chevron.classList.add("active")})),this.inputSearch.addEventListener("keyup",(()=>{this.filterOptions(),this.originalInput&&this.selectOptions()})),this.options.forEach((e=>{e.addEventListener("click",(()=>{this.selectOption(e)}))})),document.addEventListener("click",(e=>{this.containerSearchableField.contains(e.target)||(this.containerOptions.classList.remove("active"),this.chevron.classList.remove("active"))}))}selectOption(e){this.inputSearch.value=e.innerText,this.originalInput&&(this.originalInput.value=e.innerText),this.originalOptionsSelect.forEach((t=>{t.value===e.value?t.selected=!0:t.selected=!1})),this.containerOptions.classList.remove("active"),this.createDelatableAction()}selectOptions(){this.originalOptionsSelect.forEach((e=>{-1!==e.innerText.toLowerCase().indexOf(this.inputSearch.value)?e.selected=!0:e.selected=!1}))}filterOptions(){const e=this.inputSearch.value.toLowerCase();this.originalInput&&(this.originalInput.value=this.inputSearch.value),this.options.forEach((t=>{t.innerText.toLowerCase().replace(/-/g," ").indexOf(e)>-1||t.innerText.toLowerCase().indexOf(e)>-1?t.classList.remove("hidden"):t.classList.add("hidden")}))}createInputSearch(){var e;this.inputSearch=document.createElement("input"),this.inputSearch.type="text",this.inputSearch.placeholder="",this.inputSearch.value=null!==(e=this.originalSelect.querySelector("option:checked"))&&void 0!==e&&e.value?this.originalSelect.querySelector("option:checked").innerText:"",this.inputSearch.classList.add("input-search","form-control"),this.containerSearchableField.appendChild(this.inputSearch)}createContainerOptions(){this.containerOptions=document.createElement("div"),this.containerOptions.classList.add("container-options"),this.containerSearchableField.appendChild(this.containerOptions),this.createOptions()}createOptions(){this.options=[],this.originalOptionsSelect.forEach((e=>{const t=document.createElement("div");t.classList.add("option"),t.innerText=e.innerText,t.value=e.value,this.containerOptions.appendChild(t),this.options.push(t)}))}createDelatableAction(){const e=document.createElement("div");e.classList.add("delete-action"),e.innerHTML='<i class="fas fa-times"></i>',this.containerSearchableField.appendChild(e),e.addEventListener("click",(()=>{this.inputSearch.value="",this.originalOptionsSelect.forEach((e=>{e.selected=!1})),e.remove()}))}createChevron(){this.chevron=document.createElement("div"),this.chevron.classList.add("chevron"),this.chevron.innerHTML='<i class="fas fa-chevron-down"></i>',this.containerSearchableField.appendChild(this.chevron)}}class W{constructor(e,t){this.container=e,this.previewCallback=t,this.input=this.container.querySelector("input"),this.preview=this.container.querySelector(".preview"),this.removeTrigger=this.container.querySelector(".remove-file-trigger"),this.sourcePreview=this.preview.getAttribute("src"),this.addToLibrary=this.container.querySelector(".add-to-library"),this.sourcePreview.length&&this.updateTrigger(!0),this.readURL=this.readURL.bind(this),this.onRemove=this.onRemove.bind(this),this.input.addEventListener("change",this.readURL),this.removeTrigger&&this.removeTrigger.addEventListener("click",this.onRemove)}readURL(){const e=this.input.files&&this.input.files[0];if(e){const t=new FileReader;t.onload=e=>this.loadFile(e,e.target.result),t.readAsDataURL(e)}}onRemove(){this.removeFile()}loadFile(e,t){this.updateTrigger(!0),this.previewFile(t,this.input.files[0].type)}removeFile(){this.updateTrigger(!1),this.previewFile(null)}updateTrigger(e){this.removeTrigger&&(this.removeTriger.style.display=e?"block":"none"),this.input.style.display=e?"none":"block",e||(this.input.value="")}previewFile(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===e)return this.preview.style.display="none",void(this.input.style.display="block");t.startsWith("image/")?(this.preview.setAttribute("src",e),this.preview.style.display="block",this.input.style.display="none"):"application/pdf"===t&&(this.preview.setAttribute("src",this.preview.getAttribute("data-pdf-preview")),this.preview.style.display="block",this.input.style.display="none"),this.addToLibrary.style.display="block",this.previewCallback()}}class ${constructor(e){this.container=e,this.containerBody=e.querySelector(".files-list"),this.itemPrototype=this.containerBody.getAttribute("data-prototype"),this.maxItems=parseInt(this.containerBody.getAttribute("data-max-items"),10),this.addBtn=e.querySelector("button.add-file"),this.addFromLibraryBtn=e.querySelector("button.add-from-library"),this.lastIndex=this.containerBody.querySelectorAll("li").length,this.files=[...this.container.querySelectorAll("[data-add-file]")],this.renderPreview=this.renderPreview.bind(this),this.addBtn.addEventListener("click",(()=>this.add())),this.containerBody.querySelectorAll(".files-list__item").forEach((e=>{new W(e,this.renderPreview)})),this.containerBody.addEventListener("click",(e=>{if(e.target.matches(".move-file-up:not([disabled])")||e.target.closest(".move-file-up:not([disabled])")){const t=e.target.closest("li");this.moveUp(t)}else if(e.target.matches(".move-file-down:not([disabled])")||e.target.closest(".move-file-down:not([disabled])")){const t=e.target.closest("li");this.moveDown(t)}else if(e.target.matches(".remove-file")||e.target.closest(".remove-file")){const t=e.target.closest("li");this.remove(t)}})),this.files.forEach((e=>e.addEventListener("click",(t=>{t.preventDefault(),this.add(JSON.parse(e.getAttribute("data-add-file")))})))),this.refresh()}add(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.containerBody.querySelectorAll("li").length===this.maxItems)return void this.refresh();const t=this.itemPrototype.replace(/__name__/g,this.lastIndex);if(this.lastIndex+=1,this.containerBody.insertAdjacentHTML("beforeend",t),null===e){this.containerBody.querySelector("#sign_files_".concat(this.lastIndex-1,"_file")).click()}if(e){const t=this.containerBody.querySelector(".files-list__item:last-child");t.querySelector('[data-fill="library_file_id"]').value=e.id;const i=t.querySelector(".preview");i.src=e.preview,i.style.display="block";t.querySelector(".form-control-file").style.display="none";t.querySelector(".form-check").style.display="none"}const i=this.containerBody.querySelectorAll(".files-list__item");new W(i[i.length-1],this.renderPreview),this.refresh()}moveUp(e){e.parentNode.insertBefore(e,e.previousElementSibling),this.refresh()}moveDown(e){e.parentNode.insertBefore(e.nextElementSibling,e),this.refresh()}remove(e){e.parentNode.removeChild(e),this.refresh()}refresh(){this.containerBody.querySelectorAll(".position").forEach(((e,t)=>{e.value=t})),document.querySelectorAll(".move-file-up, .move-file-down").forEach((e=>e.removeAttribute("disabled"))),document.querySelectorAll("li:first-child .move-file-up, li:last-child .move-file-down").forEach((e=>e.setAttribute("disabled","disabled")));this.containerBody.querySelectorAll(".files-list__item").length===this.maxItems?(this.addBtn.setAttribute("disabled","disabled"),this.addFromLibraryBtn.setAttribute("disabled","disabled")):(this.addBtn.removeAttribute("disabled"),this.addFromLibraryBtn.removeAttribute("disabled")),this.renderPreview()}renderPreview(){let e="";this.containerBody.querySelectorAll("img.preview").forEach((t=>{e+='<img src="'.concat(t.getAttribute("src"),'" data-controller="retryable"/>')})),document.querySelector(".sign__files").innerHTML=e}}class J{constructor(e){var t,i;this.container=e,this.image=e.querySelector('[data-lightbox-target="image"]'),this.label=e.querySelector('[data-lightbox-target="label"]'),this.items=[],this.currentIndex=0,this.isOpen=!1,e.querySelectorAll('[data-action="close"]').forEach((e=>e.addEventListener("click",(()=>this.close())))),null===(t=e.querySelector('[data-action="prev"]'))||void 0===t||t.addEventListener("click",(()=>this.showPrev())),null===(i=e.querySelector('[data-action="next"]'))||void 0===i||i.addEventListener("click",(()=>this.showNext())),document.addEventListener("keydown",(e=>this.handleKeydown(e)))}setItems(e){this.items=e}openByUid(e,t){const i=this.items.findIndex((t=>t.uid===e));this.currentIndex=-1!==i?i:0;const s=this.items[this.currentIndex];s.src.endsWith(".gif")?this.displayItem(s.src,t):this.fetchAndDisplay(e,t),this.container.classList.remove("d-none"),document.body.style.overflow="hidden",this.isOpen=!0}fetchAndDisplay(e,t){const i=this.container.dataset.url.replace("UID_PLACEHOLDER",e);fetch(i).then((e=>{if(!e.ok)throw new Error("HTTP error ".concat(e.status));return e.json()})).then((e=>{if(!e.success)throw new Error(e.error||"Error");this.items[this.currentIndex].src=e.url,this.displayItem(e.url,t)})).catch({})}displayItem(e,t){this.container.querySelectorAll(".infinite-scroll-loader").forEach((e=>e.remove()));const i=document.querySelector(".animated-loader");if(i){const e=i.cloneNode(!0);e.classList.remove("animated-loader--show","d-none");const t=document.createElement("div");t.classList.add("infinite-scroll-loader"),t.appendChild(e);this.container.querySelector(".lightbox__content").appendChild(t)}this.image.classList.add("d-none"),this.label.classList.add("d-none"),this.image.onload=()=>{this.container.querySelectorAll(".infinite-scroll-loader").forEach((e=>e.remove())),this.image.classList.remove("d-none"),this.label.classList.remove("d-none")},this.image.src="",this.image.src=e,this.label.textContent=t||""}close(){this.container.classList.add("d-none"),this.image.src="",document.body.style.overflow="",this.isOpen=!1}showNext(){if(!this.items.length)return;this.currentIndex=(this.currentIndex+1)%this.items.length;const e=this.items[this.currentIndex];e.src.endsWith(".gif")?this.displayItem(e.src,e.label):this.fetchAndDisplay(e.uid,e.label)}showPrev(){if(!this.items.length)return;this.currentIndex=(this.currentIndex-1+this.items.length)%this.items.length;const e=this.items[this.currentIndex];e.src.endsWith(".gif")?this.displayItem(e.src,e.label):this.fetchAndDisplay(e.uid,e.label)}handleKeydown(e){if(this.isOpen)switch(e.key){case"ArrowLeft":this.showPrev();break;case"ArrowRight":this.showNext();break;case"Escape":this.close()}}}class Y{constructor(e){this.container=e,this.containerBody=e.querySelector("#files-list"),this.containerMediaModulePhototheques=e.querySelector("#media-phototheques-list"),this.deleteButtons=e.querySelectorAll(".delete-media-module-phototheque"),this.infoModal=document.getElementById("info-modal"),this.itemPrototype=this.containerBody.getAttribute("data-prototype"),this.addBtn=e.querySelector("button#add-file"),this.inputFile=e.querySelector("input#file"),this.maxItems=parseInt(this.containerBody.getAttribute("data-max-items"),10),this.lastIndex=this.containerBody.querySelectorAll("div").length,this.inputFile.addEventListener("change",(e=>this.add(e))),this.path=window.location.pathname.split("/"),this.deletePath="/".concat(this.path[1],"/").concat(this.path[2],"/").concat(this.path[3],"/").concat(this.path[4],"/delete-file"),this.path="/".concat(this.path[1],"/").concat(this.path[2],"/").concat(this.path[3],"/").concat(this.path[4],"/upload"),this.addBtn.addEventListener("click",(()=>{this.containerBody.querySelectorAll("div").length>=this.maxItems?r()(this.infoModal).modal("show"):this.inputFile.click()})),this.createInput=this.createInput.bind(this),this.uploadFile=this.uploadFile.bind(this),this.addMediaPhototheque=this.addMediaPhototheque.bind(this),this.deleteFile=this.deleteFile.bind(this),this.initExistingMediaItems(),this.lightbox=new J(document.querySelector("#lightbox-viewer")),this.collectLightboxItems()}add(e){const t=Array.from(e.target.files);let i=!1;t.forEach((e=>{e.size>1e7&&(i=!0)})),i||(t.forEach((e=>{if(!(this.containerBody.querySelectorAll("div").length>=this.maxItems)){const t=new DataTransfer;t.items.add(e),this.createInput(),this.uploadFile(t.files,this.lastIndex)}})),this.addBtn.value="")}createInput(){if(this.containerBody.querySelectorAll("li").length===this.maxItems)return void this.refresh();const e=this.itemPrototype.replace(/__name__/g,this.lastIndex);this.containerBody.insertAdjacentHTML("beforeend",e);const t=document.querySelector("#module_phototheque_mediaModulePhototheques_".concat(this.lastIndex,"_position"));t&&(t.value=this.lastIndex);const i=document.querySelector(".animated-loader").cloneNode(!0),s=document.createElement("div");s.classList.add("infinite-scroll-loader"),s.appendChild(i);const n='\n            <div class="media-photo-library-item" data-item-number="'.concat(this.lastIndex,'">\n            </div>\n        '),o=document.createElement("div");o.innerHTML=n;const a=o.firstElementChild;this.containerMediaModulePhototheques.appendChild(a),r()(a).html(s),r()(a).addClass("load"),this.lastIndex+=1}async uploadFile(e,t){const i=new FormData;i.append("file",e[0]);const s={method:"post",body:i};await fetch(this.path,s).then((e=>e.json())).then((e=>{const i=document.querySelector("#module_phototheque_mediaModulePhototheques_".concat(t-1,"_fileUid"));this.addMediaPhototheque(e.url,t,e.uid),i.value=e.uid}))}addMediaPhototheque(e,t,i){const s=()=>{const n=new Image;n.onload=()=>{const s=document.querySelector('div[data-item-number="'.concat(t-1,'"]')),n=document.querySelector("#module_phototheque_mediaModulePhototheques_".concat(t-1,"_fileUid"));n.value=i,s.dataset.uid=i;const o=s.querySelector(".infinite-scroll-loader");o&&o.remove(),s.classList.remove("load"),this.containerMediaModulePhototheques.setAttribute("data-controller","phototheque-sortable");const a=document.createElement("div");a.classList.add("header");const r=document.createElement("img");r.src=e,r.alt="Photo ajoutée",a.appendChild(r),a.appendChild(this.createDragHandle()),a.appendChild(this.createActionsButtons(i,s));let l=document.querySelector("#module_phototheque_mediaModulePhototheques_".concat(t-1,"_label"));l||(l=document.createElement("input"),l.type="hidden",l.name="module_phototheque[mediaModulePhototheques][".concat(t-1,"][label]"),l.id="module_phototheque_mediaModulePhototheques_".concat(t-1,"_label"),l.value="",this.containerBody.appendChild(l));let d=document.querySelector("#module_phototheque_mediaModulePhototheques_".concat(t-1,"_position"));d||(d=document.createElement("input"),d.type="hidden",d.name="module_phototheque[mediaModulePhototheques][".concat(t-1,"][position]"),d.id="module_phototheque_mediaModulePhototheques_".concat(t-1,"_position"),d.value=t-1,this.containerBody.appendChild(d)),n.dataset.uid=i,l.dataset.uid=i,d.dataset.uid=i;const c=l.value,h=this.createEditableLabel(c,l);a.appendChild(h),s.appendChild(a),this.collectLightboxItems()},n.onerror=()=>{setTimeout((()=>s()),300)},n.src=e};s()}async deleteFile(e){const t=new FormData;t.append("uid",e);const i={method:"post",body:t};await fetch(this.deletePath,i)}initExistingMediaItems(){const e=Array.from(this.containerMediaModulePhototheques.querySelectorAll(".media-photo-library-item"));e.forEach(((e,t)=>{var i;const s=document.querySelector('input[name="module_phototheque[mediaModulePhototheques]['.concat(t,'][fileUid]"]')),n=document.querySelector('input[name="module_phototheque[mediaModulePhototheques]['.concat(t,'][label]"]')),o=document.querySelector('input[name="module_phototheque[mediaModulePhototheques]['.concat(t,'][position]"]')),a=null!==(i=null==s?void 0:s.value)&&void 0!==i?i:"";a&&(e.dataset.uid=a,s.dataset.uid=a,n&&(n.dataset.uid=a),o&&(o.dataset.uid=a))})),e.sort(((e,t)=>{var i,s,n,o;const a=e.dataset.uid,r=t.dataset.uid;return parseInt(null!==(i=null===(s=document.querySelector('input[data-uid="'.concat(a,'"][name*="[position]"]')))||void 0===s?void 0:s.value)&&void 0!==i?i:0,10)-parseInt(null!==(n=null===(o=document.querySelector('input[data-uid="'.concat(r,'"][name*="[position]"]')))||void 0===o?void 0:o.value)&&void 0!==n?n:0,10)})),this.containerMediaModulePhototheques.innerHTML="",e.forEach((e=>{this.containerMediaModulePhototheques.appendChild(e)})),e.forEach((e=>{var t;const i=e.dataset.uid,s=document.querySelector('input[data-uid="'.concat(i,'"][name*="[label]"]')),n=null!==(t=null==s?void 0:s.value)&&void 0!==t?t:"",o=e.querySelector(".header");if(!i||!o)return;const a=this.createActionsButtons(o.getAttribute("data-uid"),e),r=this.createEditableLabel(n,s);o.appendChild(a),o.appendChild(this.createDragHandle()),o.appendChild(r),this.containerMediaModulePhototheques.setAttribute("data-controller","phototheque-sortable")}))}createActionsButtons(e,t){const i=document.createElement("div");i.classList.add("actions");const s=document.createElement("button");s.classList.add("delete"),s.classList.add("delete-media-module-phototheque"),s.setAttribute("type","button"),s.addEventListener("click",(()=>{this.deleteFile(e);this.containerBody.querySelectorAll('input[data-uid="'.concat(e,'"')).forEach(((e,t)=>{0===t?e.parentNode.remove():e.remove()})),t.remove(),this.collectLightboxItems()}));const n=document.createElement("i");n.classList.add("fas","fa-trash-alt","fa-xs"),s.appendChild(n),s.innerHTML='<i class="fas fa-trash-alt fa-xs"></i>';const o=document.createElement("button");return o.classList.add("zoom"),o.setAttribute("type","button"),o.innerHTML='<i class="fas fa-search-plus fa-xs"></i>',o.addEventListener("click",(()=>{var e,i;const s=t.dataset.uid,n=null!==(e=null===(i=t.querySelector("textarea"))||void 0===i?void 0:i.value)&&void 0!==e?e:"",o=this.collectLightboxItems();this.lightbox.setItems(o),this.lightbox.openByUid(s,n)})),i.appendChild(s),i.appendChild(o),i}createEditableLabel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;const i=document.createElement("textarea");i.rows=2,i.placeholder="Cliquez ici pour\n ajouter une légende",i.classList.add("media-label-edit"),i.maxLength=40,i.value=e.replace(/\\n/,"\n"),i.style.pointerEvents="auto";let s=e;return i.addEventListener("keydown",(e=>{const t=i.value.split("\n"),n=i.selectionStart,o=i.value.substring(0,n).split("\n").length;if("Enter"===e.key){if(e.preventDefault(),t.length<2)return void(i.value+="\n");if(1===o&&t[1].length<=20){const e=t[0].length;return void i.setSelectionRange(e+1,e+1)}if(o>=2)return void i.blur()}"Escape"===e.key&&(e.preventDefault(),i.value=s,i.blur())})),i.addEventListener("blur",(()=>{t.value=i.value.replace(/\r\n/,"\n").replace(/\n/,"\\n"),s=i.value,this.collectLightboxItems()})),i.addEventListener("beforeinput",(e=>{var t;const s=i.value,n=i.selectionStart,o=i.selectionEnd;let a="";"insertLineBreak"===e.inputType?a="\n":e.data&&(a=e.data);const r=(s.slice(0,n)+a+s.slice(o)).split("\n"),l=(null===(t=r[1])||void 0===t?void 0:t.length)>20;(r.length>2||l)&&e.preventDefault()})),i}createDragHandle(){const e=document.createElement("div");return e.classList.add("drag-handle"),e.innerHTML='<i class="fas fa-bars"></i>',e}collectLightboxItems(){const e=Array.from(this.containerMediaModulePhototheques.querySelectorAll(".media-photo-library-item")).map((e=>{var t,i;const s=e.querySelector("img"),n=null!==(t=null===(i=e.querySelector("textarea"))||void 0===i?void 0:i.value)&&void 0!==t?t:"";return{uid:e.dataset.uid,src:null==s?void 0:s.src,label:n}}));return this.lightbox.setItems(e),e}}var X=i(6430),Z=i(1330);class Q{constructor(e){this.container=e,this.containerBody=this.container.querySelector("#notifications-list"),this.addNotification=this.container.querySelector("#button-add-notification"),this.notificationsDate=this.container.querySelector("#notifications-date"),this.checkbox=this.container.querySelectorAll('[type="checkbox"]'),this.itemPrototype=this.containerBody.getAttribute("data-prototype"),this.inputs=this.containerBody.querySelectorAll("input"),this.lastIndex=this.containerBody.querySelectorAll("input").length,this.dateList=[],this.startPublication=document.querySelector('[data-id="startAt"]'),this.today=new Date,this.endPublication=document.querySelector('[data-id="endAt"]'),this.configDate={weekday:"long",day:"numeric",month:"long",year:"numeric"},this.init()}init(){this.addNotification.addEventListener("click",(()=>{this.add()})),this.startPublication.addEventListener("change",(e=>{0!==this.dateList.length&&this.clearNotificationList("start",e.target.value),this.dateList.push(e.target.value)})),this.endPublication.addEventListener("change",(e=>{0!==this.dateList.length&&this.clearNotificationList("end",e.target.value)})),document.addEventListener("DOMContentLoaded",(()=>{this.inputs=this.containerBody.querySelectorAll(".datepicker"),this.inputs.forEach((e=>{e.style.display="none",e.getAttribute("data-config")&&(new Date(e.value)>=this.today&&(this.createDatePopup(e.value),this.verifiedCheckbox("add",e.value)),this.dateList.push(e.value))})),this.sortDate()})),this.checkbox.forEach((e=>{e.addEventListener("click",(()=>{const t=new Date(this.endPublication.value);t.setDate(t.getDate()-e.value);const i=t.toISOString().slice(0,10);if(e.checked&&!this.dateList.includes(i)){this.createInput();const e=this.containerBody.querySelectorAll("input")[this.containerBody.querySelectorAll("input").length-1];e.value=i,e.type="hidden",this.createDatePopup(i)}else!e.checked&&this.dateList.includes(i)&&this.deleteDatePopup(i);this.sortDate()}))}))}add(){this.createInput();const e=this.containerBody.querySelectorAll("input")[this.containerBody.querySelectorAll("input").length-1],t=e.getAttribute("data-config"),i=this.container.querySelector("#notification-calendar");this.changeCalendarPosition(i);const s=this.configCalendar(e,i,t);this.containerBody.querySelectorAll(".input")[this.containerBody.querySelectorAll(".input").length-1].style.display="none",s.open(),e.addEventListener("change",(e=>{""!==e.target.value&&(this.createDatePopup(e.target.value),this.verifiedCheckbox("add",e.target.value))}))}createInput(){const e=this.itemPrototype.replace(/__name__/g,this.lastIndex);this.lastIndex+=1,this.containerBody.insertAdjacentHTML("beforeend",e)}configCalendar(e,t,i){const s=new Date(document.querySelector('[data-id="startAt"]').value),n=document.querySelector('[data-id="endAt"]').value;return(0,X.A)(e,{appendTo:t,locale:Z.French,...JSON.parse(i),minDate:s<this.today?this.today:s,maxDate:n,disable:[...this.dateList,this.today],disableMobile:!0,onClose:function(t,i,s){0===t.length?(e.remove(),s.altInput.remove()):s.altInput.setAttribute("data-value",i)}})}changeCalendarPosition(e){e.style.left="".concat(this.addNotification.offsetLeft,"px"),e.style.top="".concat(this.addNotification.offsetTop+30,"px")}createDatePopup(e){this.dateList.push(e);const t=new Date(e);this.popup='\n            <div id="notification-date" class="notification-date">\n                <div class="date" data-value="'.concat(e,'">').concat(t.toLocaleDateString("fr-Fr",this.configDate),'</div>\n                <div class="cancel_date"><i class="fa fa-circle circle"><i class="fa fa-times xmark"></i></i></div>\n            </div>\n        '),this.notificationsDate.innerHTML+=this.popup,this.setupDeletePopup(),this.sortDate()}setupDeletePopup(){this.notificationsDate.querySelectorAll(".notification-date").forEach((e=>{const t=e.querySelector(".date"),i=e.querySelector(".cancel_date"),s=t.getAttribute("data-value");i.addEventListener("click",(()=>{this.deleteDatePopup(s),this.verifiedCheckbox("delete",s)}))}))}deleteDatePopup(e){this.containerBody.querySelectorAll('[type="hidden"]').forEach((t=>{if(t.value===e){t.remove(),this.dateList=this.dateList.filter((t=>t!==e));const i=this.containerBody.querySelector('[data-value="'.concat(e,'"]'));null==i||i.remove();this.notificationsDate.querySelector('[data-value="'.concat(e,'"]')).parentNode.remove()}}))}clearNotificationList(e,t){switch(e){case"start":this.dateList.forEach((e=>{t>=e&&this.deleteDatePopup(e)}));break;case"end":this.checkbox.forEach((e=>{e.checked=!1})),this.dateList.forEach((e=>{t<e&&this.deleteDatePopup(e)}))}}verifiedCheckbox(e,t){const i=new Date(this.endPublication.value);switch(e){case"add":this.checkbox.forEach((e=>{i.setDate(i.getDate()-e.value),t===i.toISOString().slice(0,10)&&(e.checked=!0)}));break;case"delete":this.checkbox.forEach((e=>{i.setDate(i.getDate()-e.value),t===i.toISOString().slice(0,10)&&(e.checked=!1)}))}}sortDate(){this.notificationsDate=this.container.querySelector("#notifications-date"),this.listNotificationDate=this.notificationsDate.querySelectorAll(".notification-date");const e=Array.from(this.listNotificationDate);e.sort(((e,t)=>new Date(e.querySelector(".date").getAttribute("data-value"))-new Date(t.querySelector(".date").getAttribute("data-value")))),this.notificationsDate.innerHTML="",e.forEach((e=>{this.notificationsDate.appendChild(e)}))}}class K{constructor(e){e.addEventListener("submit",this.onSubmit.bind(this)),this.expectedToken=e.dataset.token,this.attempt=30}refreshIfNeeded(){const e="export-progress-".concat(this.expectedToken);this.getCookie(e)!==this.expectedToken&&0!==this.attempts||(this.expireCookie(e),document.location.reload()),this.attempts-=1}onSubmit(){window.setInterval(this.refreshIfNeeded.bind(this),1e3)}getCookie(e){const t=document.cookie.split("".concat(e,"="));return 2===t.length?t.pop().split(";").shift():null}expireCookie(e){document.cookie="".concat(encodeURIComponent(e),"=deleted; expires=").concat(new Date(0).toUTCString())}}class G{constructor(e){this.container=e,this.input=this.container.querySelector("input"),this.preview=this.container.querySelector(".preview"),this.sourcePreview=this.preview.getAttribute("src"),this.signImage=document.querySelector(".sign__image"),this.sourcePreview.length&&this.displaySignImage(this.sourcePreview),this.readURL=this.readURL.bind(this),this.displaySignImage=this.displaySignImage.bind(this),this.input.addEventListener("change",this.readURL)}readURL(){const e=this.input.files&&this.input.files[0];if(e){const t=new FileReader;t.onload=e=>this.loadImage(e.target.result),t.readAsDataURL(e)}}loadImage(e){this.previewImage(e),this.displaySignImage(e)}previewImage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.preview.setAttribute("src",e),this.preview.style.display=e?"block":"none"}displaySignImage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.signImage&&(this.signImage.innerHTML=e?'<img src="'.concat(e,'">'):null)}}function ee(e){let t={title:e,fontSize:"0.9em",lineHeight:"1em"},i=Array.from(e).length;return i>20?(t.fontSize="0.8em",t.lineHeight="1em",t.title=e.substring(0,24)+"...",t):i>15&&!e.includes(" ")?(t.fontSize="0.6em",t.lineHeight="1.5em",t):i>=13&&i<=15&&!e.includes(" ")?(t.fontSize="0.7em",t.lineHeight="1em",t):i>11&&i<=25?(t.fontSize="0.8em",t.lineHeight="1em",t):i>=11?(t.fontSize="0.8em",t):t}class te{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.pageModule=e,this.pageModule&&(this.modalMedia=document.querySelector('[data-id-modal="media-module"]'),this.formMediaPreview=document.querySelector('[data-trigger-modal="media-module"]'),this.containerMedia=this.modalMedia.querySelectorAll("[data-container-media]")),this.inputTitle=document.querySelector("[data-input-title-module]"),this.titleTarget=document.querySelector("[data-input-title-module-target]"),this.inputMedia=document.querySelector("[data-input-media]"),this.init()}init(){this.setupTitle(),this.inputTitle.addEventListener("keyup",(e=>{this.inputTitle.value=this.checkLength(e.target.value),this.setupTitle()})),this.pageModule&&this.containerMedia.forEach((e=>{e.querySelectorAll("[data-media-id]").forEach((e=>{e.addEventListener("click",(()=>{this.changeModulePicto(e)}))}))}))}setupTitle(){let e=ee(this.inputTitle.value);this.titleTarget.style.fontSize=e.fontSize,this.titleTarget.style.lineHeight=e.lineHeight,this.titleTarget.innerText=e.title}changeModulePicto(e){this.inputMedia.value=e.dataset.mediaId;let t=e.dataset.color,i=e.querySelector("img").src;this.formMediaPreview.style.background=t,this.formMediaPreview.querySelector("img").src=i,this.modalMedia.classList.remove("active")}checkLength(e){return e.length>20?e.slice(0,20):e}}class ie{constructor(e){this.list=document.querySelector("#lien-interne-list"),this.element=e,this.options=[],this.optionsChooses=[],this.optionsValue=[],this.modal=document.querySelector(".modal-lien-interne"),this.names=[],this.placeholder=this.element.getAttribute("placeholder"),this.buttonsSaveModule=document.querySelectorAll("#module_lien_interne_submit"),this.buttonsDraftModule=document.querySelectorAll("#module_lien_interne_submit_draft"),this.entityId=document.getElementsByName("modal")[0].getAttribute("aria-labelledBy"),r()(this.element).select2({minimumResultsForSearch:1/0,minimumInputLength:3,language:{inputTooShort:function(){return"Veuillez saisir au moins 3 caractères pour accéder aux résultats de votre recherche."},noResults:()=>{if(this.input.value.length<=3&&this.loading){const e=document.querySelector(".animated-loader").cloneNode(!0),t=document.createElement("div");return t.classList.add("infinite-scroll-loader"),t.appendChild(e),r()(".select2-results__options").html(t),void r()(".select2-results__options").addClass("load")}return"no Results"}},multiple:!0}),this.ul=document.querySelector(".select2-selection__rendered"),this.input=this.ul.querySelector("input"),this.input.placeholder=this.placeholder,this.deleteElement=this.deleteElement.bind(this),this.addItem=this.addItem.bind(this),this.openModal=this.openModal.bind(this),this.openDraftModal=this.openDraftModal.bind(this),this.changeLeftPicture=this.changeLeftPicture.bind(this),this.changeRightPicture=this.changeRightPicture.bind(this),this.chooseLogo=this.chooseLogo.bind(this),this.resetLogo=this.resetLogo.bind(this),this.cancelButtonModal=this.cancelButtonModal.bind(this),this.switchButton=this.switchButton.bind(this),this.init()}init(){r()(this.element).on("select2:select",(e=>{if(!this.optionsValue.includes(e.params.data.element.value)){this.optionsChooses.push(e.params.data.element),this.optionsValue.push(e.params.data.element.value);const t=e.params.data.text,i=document.querySelector("[data-input-media]").value;this.dataLogo=document.querySelector('option[value="'.concat(e.params.data.id,'"]')).dataset.logo,this.names.push(t),this.names.sort(),this.addItem(),this.deleteList();const s=document.querySelector('[data-media-id="'.concat(i,'"]'));this.names.length>1&&"logo-other-entity.png"===(null==s?void 0:s.getAttribute("data-media-name"))&&this.resetLogo(),this.switchButton(),this.input.placeholder=this.placeholder}})),this.input.addEventListener("input",(async e=>{this.findEntities(e)})),r()(this.element).on("select2:open",(()=>{this.input.placeholder=this.placeholder,this.input.addEventListener("input",(e=>{if("insertText"!==e.inputType&&"deleteContentBackward"!==e.inputType)return;r()(this.element).empty();let t=e.target.value.toLowerCase();t=t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),t.length>1&&this.options.forEach((e=>{let i=e.innerText.toLowerCase();i=i.normalize("NFD").replace(/[\u0300-\u036f]/g,""),i.includes(t)&&r()(this.element).append(e)})),r()(this.element).trigger("change.select2")}))})),r()(this.element).on("select2:close",(()=>{this.deleteList(),this.input.placeholder=this.placeholder})),r()(this.element).on("select2:unselect",(e=>{const t=this.names.indexOf(e.params.data.text);this.optionsChooses.splice(this.optionsChooses.indexOf(e.params.data.element),1),this.names.splice(t,1);if(document.querySelector('div[data-name="'.concat(e.params.data.text,'"]')).parentNode.remove(),this.deleteList(),1===this.names.length){const e=this.optionsChooses[0];this.dataLogo=e.dataset.logo}this.switchButton()})),0!==r()(this.element).select2("data").length&&(r()(this.element).select2("data").forEach((e=>{this.optionsChooses.push(e.element),this.optionsValue.push(e.id),this.names.push(e.text)})),this.addItem(),this.deleteList());this.modal.querySelector("#cancel-lien-interne-modal").addEventListener("click",this.cancelButtonModal),this.buttonsSaveModule[1].addEventListener("click",(()=>{this.openModal()})),this.buttonsSaveModule[0].addEventListener("click",(()=>{this.saveOptions()})),0!==this.buttonsDraftModule.length&&(this.buttonsDraftModule[1].addEventListener("click",(()=>{this.openDraftModal()})),this.buttonsDraftModule[0].addEventListener("click",(()=>{this.saveOptions()})))}deleteElement(e){const t=e.srcElement.parentNode,i=t.querySelector("div").innerHTML;this.optionsChooses.forEach((e=>{e.innerText===i&&(this.optionsChooses.splice(this.optionsChooses.indexOf(e),1),this.optionsValue.splice(this.optionsValue.indexOf(e.value),1))}));const s=this.names.indexOf(i);if(this.names.splice(s,1),r()(this.element).select2("data").forEach((e=>{if(e.text==i){const t=r()(this.element).val().filter((t=>t!==e.id));r()(this.element).val(t)}})),1===this.names.length&&1===this.optionsChooses.length){const e=this.optionsChooses[0];this.dataLogo=e.dataset.logo}this.switchButton(),t.remove(),this.input.placeholder=this.placeholder}deleteList(){const e=document.querySelector("ul.select2-selection__rendered");for(;e.childNodes.length>1;)e.firstChild.remove()}addItem(){this.list.innerHTML="",this.names.forEach((e=>{this.list.innerHTML+='<div class="lien-interne"><div class="entity" data-name="'.concat(e,'">')+e+'</div><input type="button" id="delete-lien-interne" class="btn delete-lien-interne" value="supprimer"></div>'})),this.inputs=document.querySelectorAll("#delete-lien-interne"),this.inputs.forEach((e=>{e.addEventListener("click",this.deleteElement)}))}openModal(){if(""!==this.dataLogo){this.changeLeftPicture(),this.changeRightPicture();this.modal.querySelectorAll(".picto").forEach((e=>{e.addEventListener("click",this.chooseLogo)}));document.querySelectorAll("#box").forEach((e=>{e.classList.remove("box")}));const e=this.modal.querySelector("#submit");e.removeAttribute("name"),e.addEventListener("click",(()=>{this.saveOptions()})),r()(this.modal).modal("show")}}openDraftModal(){if(""!==this.dataLogo){this.changeLeftPicture(),this.changeRightPicture();this.modal.querySelectorAll(".picto").forEach((e=>{e.addEventListener("click",this.chooseLogo)}));document.querySelectorAll("#box").forEach((e=>{e.classList.remove("box")}));const e=this.modal.querySelector("#submit");e.setAttribute("name","module_lien_interne[submit_draft]"),e.addEventListener("click",(()=>{this.saveOptions()})),r()(this.modal).modal("show")}}changeLeftPicture(){let e="https://panneau-pocket-staging.s3.gra.perf.cloud.ovh.net/";"panneau-pocket"===document.querySelector('meta[name="s3-bucket"]').content&&(e="https://panneau-pocket.s3.gra.perf.cloud.ovh.net/");let t=document.querySelector(".container-explication").querySelector("img").src;t=t.replace(/cache\/.*/,"cache/".concat(this.dataLogo)),-1!==t.indexOf("images")&&(t=e+"cache/"+this.dataLogo);const i=this.modal.querySelector(".left-picture").querySelector("img");i.src=t;const s=document.querySelector('[data-media-name="logo-other-entity.png"]');s&&i.setAttribute("data-media-id","".concat(s.getAttribute("data-media-id")))}changeRightPicture(){const e=document.querySelector(".container-explication"),t=e.querySelector(".container-preview-picto").style.backgroundColor,i=document.querySelector("[data-input-media]").value;let s=e.querySelector("img").src;this.mediaIdSelect=i,this.backgroundColorSelect=t,this.imageUrlSelect=s,-1!==s.indexOf("table_column")&&(s=s.replace("table_column","media_module"));const n=this.modal.querySelector(".right-picture");n.querySelector(".container-preview-picto").style.backgroundColor=t,n.querySelector("img").src=s,n.querySelector("img").setAttribute("data-media-id",i)}chooseLogo(e){let t=e.target;null===e.target.querySelector("img")&&(t=e.target.parentNode);const i=t.parentNode.style.backgroundColor,s=t.querySelector("img");document.querySelectorAll("#box").forEach((e=>{e.classList.remove("box")})),t.parentNode.parentNode.setAttribute("class","box");const n=document.querySelector(".container-explication");n.querySelector(".container-preview-picto").style.backgroundColor=i,n.querySelector("img").src=s.src,document.querySelector("[data-input-media]").value=s.getAttribute("data-media-id")}resetLogo(){document.querySelector("[data-id-modal]").querySelector('[alt="Liens internes"]').click()}cancelButtonModal(){const e=document.querySelector(".container-explication"),t=e.querySelector(".container-preview-picto"),i=document.querySelector("[data-input-media]"),s=e.querySelector("img");t.style.backgroundColor=this.backgroundColorSelect,i.value=this.mediaIdSelect,s.src=this.imageUrlSelect}switchButton(){"none"===this.buttonsSaveModule[0].style.display&&""!==this.buttonsSaveModule[0].style.display||1!==this.names.length||""===this.dataLogo||void 0===this.dataLogo?(this.buttonsSaveModule[0].style.display="block",this.buttonsSaveModule[1].style.display="none",0!==this.buttonsDraftModule.length&&(this.buttonsDraftModule[0].style.display="block",this.buttonsDraftModule[1].style.display="none")):(this.buttonsSaveModule[0].style.display="none",this.buttonsSaveModule[1].style.display="block",0!==this.buttonsDraftModule.length&&(this.buttonsDraftModule[0].style.display="none",this.buttonsDraftModule[1].style.display="block"))}saveOptions(){this.optionsChooses.forEach((e=>{r()(this.element).append(e)}))}async findEntities(e){let t=e.target.value.toLowerCase();"insertText"!==e.inputType&&"deleteContentBackward"!==e.inputType||(r()(this.element).empty(),t.length<=2&&!this.loading&&(this.loading=!0),"insertText"===e.inputType&&3===t.length&&(this.options=[],await this.searchEntities(e.target.value)),t=t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),t.length>1&&this.options.forEach((e=>{let i=e.innerText.toLowerCase();i=i.normalize("NFD").replace(/[\u0300-\u036f]/g,""),i.includes(t)&&r()(this.element).append(e)})),r()(this.element).trigger("change"),r()(this.input).trigger("input"))}async searchEntities(e){const t={name:e,selfEntityId:this.entityId,isPrivate:!0},i={method:"post",body:JSON.stringify(t)};await fetch("/admin/entities/all-active-entities",i).then((e=>e.json())).then((e=>{0!==e.length&&e.forEach((e=>{var t;const i=new Option(e.text+" - "+e.codePostal,e.id,!1,!1);i.setAttribute("data-logo",null!==(t=e.path)&&void 0!==t?t:""),this.options.push(i)})),this.loading=!1,r()(".select2-results__options").removeClass("load")}))}}class se{constructor(){this.modalModele=document.querySelector('[data-id-modal="modal-modele"]'),this.init()}init(){this.modalModele.querySelectorAll("[data-trigger-selected-modele]").forEach((e=>{e.addEventListener("click",(()=>{this.putWysiwygContent(e),this.modalModele.classList.remove("active")}))}));const e=document.querySelector("[data-input-title] input");e.addEventListener("input",(()=>{setTimeout((()=>{document.querySelector("[data-input-title-module-target]").innerHTML=e.value}),30)}))}putWysiwygContent(e){const t=e.querySelector(".container-picto"),i=t.querySelector("img");let s=r()(".trumbowyg-textarea"),n=document.querySelector("[data-input-title]").querySelector("input"),o=document.querySelector("[data-input-title-module-target]"),a=document.querySelector(".container-preview-picto"),l=document.querySelector(".picto"),d=document.querySelector("[data-input-media]");s.trumbowyg("html",e.dataset.triggerSelectedModele),o.innerHTML=e.dataset.selectedModeleTitle,n.value=e.dataset.selectedModeleTitle,a.style.backgroundColor=t.dataset.color,d.value=t.dataset.mediaId,l.querySelector("img").src=i.src}}class ne{constructor(){this.btnRemove=document.querySelector("[data-remove]"),this.init()}init(){this.btnRemove&&this.btnRemove.addEventListener("click",(e=>{window.confirm("Êtes-vous sûr de vouloir supprimer ce module ?")||e.preventDefault()}))}}class oe{constructor(){this.buttonSave=document.querySelector("#module_better_street_submit"),this.buttonDraft=document.querySelector("#module_better_street_submit_draft"),this.changeMessageLoader=this.changeMessageLoader.bind(this),this.init()}init(){document.querySelector(".module-betterstreet-config")&&(this.buttonSave.addEventListener("click",this.changeMessageLoader),this.buttonDraft&&this.buttonDraft.addEventListener("click",this.changeMessageLoader))}changeMessageLoader(){this.loader=document.querySelector(".animated-loader"),this.paragraphe=this.loader.querySelector("p"),this.paragraphe.firstChild.nodeValue="Vérifiez vos emails et activez votre compte BetterStreet pour finaliser la création"}}class ae{constructor(){this.buttonMailSubmit=document.querySelector("#module_submit_mail"),this.emailInput=document.querySelector("#module_email"),this.defaultEmailValue=this.emailInput?this.emailInput.value:"",this.checkEmailChange=this.checkEmailChange.bind(this),this.init()}init(){this.emailInput&&this.buttonMailSubmit&&(this.emailInput.addEventListener("input",this.checkEmailChange),this.checkEmailChange())}checkEmailChange(){this.emailInput.value===this.defaultEmailValue?(this.buttonMailSubmit.disabled=!1,this.buttonMailSubmit.style.opacity="1"):(this.buttonMailSubmit.disabled=!0,this.buttonMailSubmit.style.opacity="0.5")}}i(9391);var re=i(4062);class le{constructor(e){this.container=e.querySelector("[data-container-sortable]"),this.entityId=e.dataset.entityId,this.loader=e.querySelector(".loader"),this.init()}init(){this.loader.classList.add("active");fetch("/admin/module/".concat(this.entityId,"/list"),{method:"get",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{this.generateList(e)})).catch((e=>{console.error(e)})).finally((()=>{this.loader.classList.remove("active")}))}generateList(e){this.container.innerHTML=e,this.container.querySelectorAll(".title").forEach((e=>{let t=ee(e.innerText);e.style.fontSize=t.fontSize,e.style.lineHeight=t.lineHeight,e.innerText=t.title})),this.parent=this.container.parentElement,this.header=this.parent.querySelector(".header");const t=this.container.querySelectorAll(".item");this.header.offsetHeight+this.container.offsetHeight>this.parent.offsetHeight?(t.forEach((e=>{e.style.marginLeft=".3em"})),this.container.style.overflowY="auto"):t.forEach((e=>{e.style.marginLeft=".6em"})),document.querySelectorAll("a.edit").forEach((e=>{new re.A(e,"click")}))}}var de=i(5436);class ce{constructor(e){this.strengthOptions=[{id:0,value:"très faible",minDiversity:0,minLength:0,percent:"20",progressColor:"bg-danger"},{id:1,value:"faible",minDiversity:2,minLength:4,percent:"40",progressColor:"bg-warning"},{id:2,value:"moyenne",minDiversity:3,minLength:8,percent:"80",progressColor:"bg-info"},{id:3,value:"forte",minDiversity:4,minLength:8,percent:"100",progressColor:"bg-success"}],this.allowedSymbols="!@#$%^&*_.-",this.progressBarId="input-password-strength-message",this.container=e,this.input=this.container.querySelector("input"),this.strengthValidation=this.strengthValidation.bind(this),this.input.addEventListener("input",this.strengthValidation)}strengthValidation(){const e=(0,de.Bi)(this.input.value,this.strengthOptions,this.allowedSymbols);this.deleteProgressBar(),this.createProgressBar(this.strengthOptions[e.id])}createProgressBar(e){const t=document.createElement("small");t.setAttribute("id",this.progressBarId);const i=document.createTextNode("Sécurité"),s=document.createElement("div");s.className="progress";const n=document.createElement("div");n.className="progress-bar ".concat(e.progressColor),n.setAttribute("style","width:".concat(e.percent,"%;")),n.setAttribute("aria-valuenow","".concat(e.percent)),n.setAttribute("aria-valuemin","0"),n.setAttribute("aria-valuemax","100");const o=document.createTextNode("".concat(e.value));n.appendChild(o),s.appendChild(n),t.appendChild(i),t.appendChild(s),this.container.parentNode.append(t)}deleteProgressBar(){const e=this.container.parentNode.querySelector("#".concat(this.progressBarId));null!==e&&e.remove()}}var he=i(942),ue=(i(24),i(1574)),me=i.n(ue);class pe{constructor(e){this.container=e,this.target=document.getElementById(e.getAttribute("data-target")),this.tooLongMessage=document.getElementById(e.getAttribute("data-error")),this.form=document.forms[e.getAttribute("data-form")],this.editor=new(me())(this.container,this.getOptions()),this.maxLength=this.target.getAttribute("maxlength"),this.publishButton=document.getElementById("sign_publish"),this.draftButton=document.getElementById("sign_save"),this.renotifyButton=document.getElementById("sign_renotify"),this.save=this.save.bind(this),this.validate=this.validate.bind(this),this.onPaste=this.onPaste.bind(this),this.container.addEventListener("paste",this.onPaste),this.form.addEventListener("submit",this.save),this.editor.on("text-change",this.validate),this.load(),this.validate()}getOptions(){return{debug:!1,theme:"snow",placeholder:this.target.getAttribute("placeholder"),modules:{toolbar:!1,"emoji-toolbar":!1,"emoji-textarea":!0,keyboard:{bindings:{enter:{key:13,handler(){return!1}}}}}}}validate(){this.tooLongMessage.classList.toggle("active",!this.isLengthValid())}isLengthValid(){var e,t,i,s,n,o;this.editor.getLength()-1<=this.maxLength?(null===(e=this.draftButton)||void 0===e||e.removeAttribute("disabled"),null===(t=this.publishButton)||void 0===t||t.removeAttribute("disabled"),null===(i=this.renotifyButton)||void 0===i||i.removeAttribute("disabled")):(null===(s=this.draftButton)||void 0===s||s.setAttribute("disabled",!0),null===(n=this.publishButton)||void 0===n||n.setAttribute("disabled",!0),null===(o=this.renotifyButton)||void 0===o||o.setAttribute("disabled",!0));return this.editor.getLength()-1<=this.maxLength}onPaste(e){e.preventDefault();const t=(e.clipboardData||window.clipboardData).getData("text");this.editor.setText(t.replace(/(\r\n|\n|\r)/gm," "))}load(){this.editor.clipboard.dangerouslyPasteHTML(this.target.value,"api")}save(){this.target.value=this.editor.root.innerText}}class ge{constructor(e){this.containerBurgerMenuItems=e.querySelector(".container-items"),this.mask=e.querySelector(".mask"),this.iconeBurger=e.querySelector(".trigger-element"),e.addEventListener("click",this.toggleBurgerMenu.bind(this))}toggleBurgerMenu(){this.containerBurgerMenuItems.classList.toggle("active"),this.mask.classList.contains("active")?(this.mask.classList.add("inactive"),this.mask.classList.remove("active"),setTimeout((()=>{this.mask.classList.remove("inactive")}),300)):(this.mask.classList.add("active"),this.mask.classList.remove("inactive")),this.iconeBurger.classList.toggle("active")}}class fe{constructor(e){this.tokenSelect=e,r()(this.tokenSelect).select2({minimumResultsForSearch:1/0,templateResult:this.formatOption.bind(this)})}formatOption(e){return r()('<span><div class="token-option">'.concat(e.text,"</div></span>"))}}class ye{constructor(e){this.widgetContainer=e,this.previewWidget=this.previewWidget.bind(this);this.widgetContainer.querySelectorAll("button[data-widget-preview]").forEach((e=>e.addEventListener("click",this.previewWidget)))}previewWidget(e){e.preventDefault();const t=this.widgetContainer.querySelector("form[data-widget-preview-form]");let i="false";e.target.hasAttribute("data-widget-download")&&(i="true"),t.querySelector("input[data-widget-download]").value=i,t.submit()}}const be=me().import("blots/inline");class ve extends be{static create(e){const t=super.create(e);return t.setAttribute("href","tel:".concat(this.sanitize(e))),t.setAttribute("rel","noopener noreferrer"),t.setAttribute("target","_blank"),t}static formats(e){return e.getAttribute("href")}static sanitize(e){return e.replace(/\D/gi,"")}format(e,t){e===this.statics.blotName&&t?this.domNode.setAttribute("href","tel:".concat(this.constructor.sanitize(t))):super.format(e,t)}}ve.blotName="phone",ve.className="ql-phone",ve.tagName="a";const we=me().import("core/module");class Se extends we{constructor(e,t){super(e,t),this.quill=e,this.toolbar=e.getModule("toolbar"),this.handler=this.handler.bind(this),void 0!==this.toolbar&&this.toolbar.addHandler("phone",this.handler);const i=document.getElementsByClassName("ql-phone");i&&Array.from(i).forEach((e=>{e.innerHTML=t.buttonIcon}))}handler(e){if(!0===e){const e=this.quill.getSelection();if(e&&0!==e.length){const t=this.quill.getText(e.index,e.length);this.quill.format("phone",t,me().sources.USER)}else{const t=e.index||0,i=prompt("Entrer un numéro de téléphone :");if(!i)return;this.quill.insertText(t,i,"phone",i,me().sources.USER)}}}}Se.DEFAULTS={buttonIcon:'<svg viewbox="0 0 512 512"><path class="ql-fill" d="M24.805 160.388c0.645-49.030 16.905-89.701 53.384-121.371 7.695-6.682 15.543-13.195 23.301-19.798 17.075-14.549 33.872-15.481 49.558 0.331 24.905 25.093 43.906 54.584 55.221 88.233 6.773 20.138 1.012 38.091-15.274 52.112-8.555 7.363-17.12 14.8-26.231 21.438-18.204 13.241-23.552 27.539-17.388 49.263 4.193 14.8 11.629 28.022 20.3 40.564 20.864 30.181 44.703 57.738 72.905 81.334 10.41 8.707 21.608 16.224 34.625 20.712 16.358 5.635 30.477 2.445 42.777-9.837 8.403-8.367 17.164-16.35 25.899-24.368 17.236-15.857 36.551-18.195 57.55-8.448 3.87 1.791 7.731 3.682 11.252 6.065 21.841 14.853 41.836 31.938 59.789 51.315 4.587 4.937 8.224 11.010 11.199 17.101 5.743 11.763 4.587 23.704-4.354 33.137-30.549 32.287-64.322 59.332-110.773 64.672-33.084 3.798-64.6-1.953-95.005-14.737-38.638-16.242-71.776-40.752-101.885-69.428-46.173-43.969-86.701-92.461-116.425-149.277-14.88-28.435-25.55-58.311-29.089-90.418-0.753-6.638-0.977-13.331-1.335-18.598z"></path></svg>'};const Ee=me().import("blots/inline");class Ae extends Ee{static create(e){const t=super.create(e);return t.setAttribute("href","mailto:".concat(this.sanitize(e))),t.setAttribute("rel","noopener noreferrer"),t.setAttribute("target","_blank"),t}static formats(e){return e.getAttribute("href")}static sanitize(e){return e.replace(/^(mailto:)?(.+@.+\..+)$/gi,"$2").trim()}format(e,t){e===this.statics.blotName&&t?this.domNode.setAttribute("href","mailto:".concat(this.constructor.sanitize(t))):super.format(e,t)}}Ae.blotName="email",Ae.className="ql-email",Ae.tagName="a";const Le=me().import("core/module");class qe extends Le{constructor(e,t){super(e,t),this.quill=e,this.toolbar=e.getModule("toolbar"),this.handler=this.handler.bind(this),void 0!==this.toolbar&&this.toolbar.addHandler("email",this.handler);const i=document.getElementsByClassName("ql-email");i&&Array.from(i).forEach((e=>{e.innerHTML=t.buttonIcon}))}handler(e){if(!0===e){const e=this.quill.getSelection();if(e&&0!==e.length){const t=this.quill.getText(e.index,e.length);this.quill.format("email",t,me().sources.USER)}else{const t=e.index||0,i=prompt("Entrer une adresse email :");if(!i)return;this.quill.insertText(t,i,"email",i,me().sources.USER)}}}}qe.DEFAULTS={buttonIcon:'<svg viewBox="0 0 512 512"><path  class="ql-fill" d="M503.211 416.654c0 0-96.414-107.298-148.466-162.911 52.459-50.986 150.822-150.5 150.822-150.5l-2.353 313.41z"></path><path  class="ql-fill" d="M6.436 98.712l10.275 10.038c0 0 95.945 93.424 144.55 140.849-5.452 7.14-140.754 153.165-140.754 153.165l-14.059 14.452-0.011-318.505z"></path><path  class="ql-fill" d="M17.861 80c161.384 0 318.409 0 479.299 0-7.12 7.665-11.726 12.981-16.705 17.884-65.041 63.866-130.126 127.712-195.227 191.483-21.587 21.139-35.274 21.286-56.464 0.393-65.88-64.933-131.653-129.95-197.424-194.975-3.729-3.683-7.096-7.766-13.474-14.785z"></path><path  class="ql-fill" d="M489.912 432c-158.637 0-312.78 0-471.086 0 53.123-56.486 103.751-110.317 155.342-165.168 16.352 14.805 30.79 28.647 46.043 41.524 27.963 23.572 51.732 23.419 78.399-1.837 13.062-12.356 26.531-23.689 40.863-38.509 53.455 58.162 98.617 107.596 150.439 163.989z"></path></svg>'};var Ce=i(7678),xe=i(7998),ke=i(7939);class Me extends ke.R{constructor(e,t){super(e,t),this.preview=this.root.querySelector("a.ql-preview"),this.range={phone:null,email:null}}listen(){super.listen(),this.root.querySelector("a.ql-action").addEventListener("click",(e=>this.onAction(e))),this.root.querySelector("a.ql-remove").addEventListener("click",(e=>this.onRemove(e))),this.quill.on(Ce.A.events.SELECTION_CHANGE,((e,t,i)=>this.onSelectionChange(e,t,i)))}onAction(e){this.root.classList.contains("ql-editing")?this.save():this.edit(this.root.getAttribute("data-mode"),this.preview.textContent),e.preventDefault()}onRemove(e){this.removeFormat("phone"),this.removeFormat("email"),e.preventDefault(),this.hide()}onSelectionChange(e,t,i){if(null!==e){if(0===e.length&&i===Ce.A.sources.USER){if(this.load(e,ve,"phone"))return;if(this.load(e,Ae,"email"))return}else this.range.phone=null,this.range.email=null;this.hide()}}removeFormat(e){const t=this.range[e];null!==t&&(this.restoreFocus(),this.quill.formatText(t,e,!1,Ce.A.sources.USER),this.range[e]=null)}load(e,t,i){const[s,n]=this.quill.scroll.descendant(t,e.index);if(null===s)return!1;this.range[i]=new xe.Q(e.index-n,s.length());const o=t.sanitize(t.formats(s.domNode));return this.preview.textContent=o,this.preview.setAttribute("href",o),this.show(i),this.position(this.quill.getBounds(this.range[i])),!0}save(){const{value:e}=this.textbox,t=this.root.getAttribute("data-mode");if(t){const{scrollTop:i}=this.quill.root;this.range[t]?(this.quill.formatText(this.range[t],t,e,Ce.A.sources.USER),this.range[t]=null):(this.restoreFocus(),this.quill.format(t,e,Ce.A.sources.USER)),this.quill.root.scrollTop=i}super.save()}show(e){super.show(),this.root.setAttribute("data-mode",e)}}Me.TEMPLATE=['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="https://www.youtube.com/watch?v=">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join("");const Ie=me().import("themes/snow");const De='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="ql-fill" d="M2 3.9934C2 3.44476 2.45531 3 2.9918 3H21.0082C21.556 3 22 3.44495 22 3.9934V20.0066C22 20.5552 21.5447 21 21.0082 21H2.9918C2.44405 21 2 20.5551 2 20.0066V3.9934ZM4 5V19H20V5H4ZM10.6219 8.41459L15.5008 11.6672C15.6846 11.7897 15.7343 12.0381 15.6117 12.2219C15.5824 12.2658 15.5447 12.3035 15.5008 12.3328L10.6219 15.5854C10.4381 15.708 10.1897 15.6583 10.0672 15.4745C10.0234 15.4088 10 15.3316 10 15.2526V8.74741C10 8.52649 10.1791 8.34741 10.4 8.34741C10.479 8.34741 10.5562 8.37078 10.6219 8.41459Z"></path></svg>',Te=me().import("blots/block/embed");class Be extends Te{static create(e){const t=super.create(e);if(e.includes("dailymotion.com")||e.includes("dai.ly")){const i=Be.extractDailymotionId(e);if(i){const e=document.createElement("iframe");e.setAttribute("title","Dailymotion Video Player"),e.setAttribute("frameborder","0"),e.setAttribute("allowfullscreen","true"),e.setAttribute("sandbox","allow-scripts allow-same-origin");const s="https://geo.dailymotion.com/player.html?video=".concat(i,"&autoplay=0&queue-enable=false");e.setAttribute("src",s),t.appendChild(e)}}else{const i=document.createElement("iframe");i.setAttribute("frameborder","0"),i.setAttribute("allowfullscreen","true"),i.setAttribute("src",e),t.appendChild(i)}return t}static extractDailymotionId(e){const t=e.match(/(?:dailymotion\.com\/video\/|dai\.ly\/|video=)([^_?]+)/);return t?t[1]:null}}Be.blotName="video",Be.tagName="div",Be.className="ql-video",me().register({"themes/panneaupocket":class extends Ie{extendToolbar(e){super.extendToolbar(e);const t=document.getElementsByClassName("ql-video");t&&Array.from(t).forEach((e=>{e.innerHTML=De})),this.pocketTooltip=new Me(this.quill,this.options.bounds)}},"formats/phone":ve,"formats/email":Ae,"formats/video":Be,"modules/phone-toolbar":Se,"modules/email-toolbar":qe},!0);class _e{constructor(e){this.container=e,this.target=document.getElementById(e.getAttribute("data-target")),this.form=document.forms[e.getAttribute("data-form")],this.editor=new(me())(this.container,this.getOptions()),this.save=this.save.bind(this),this.form.addEventListener("submit",this.save),this.load()}getOptions(){return{debug:!1,theme:"panneaupocket",formats:["bold","italic","color","link","emoji","phone","email","video"],placeholder:this.target.getAttribute("placeholder"),modules:{"emoji-toolbar":!0,"phone-toolbar":!0,"email-toolbar":!0,toolbar:{container:this.container.getAttribute("data-toolbar")}}}}load(){this.editor.clipboard.dangerouslyPasteHTML(this.target.value,"api")}save(){this.target.value=this.editor.root.innerHTML}}i.p,i(7856),i(8647),i(2453),i(9635),i(8013),i(2462);class Pe{constructor(e){this.element=e,this.messages=document.querySelectorAll("[data-announcement-type-help]"),this.refresh=this.refresh.bind(this),this.element.addEventListener("change",this.refresh),this.refresh()}refresh(){this.messages.forEach((e=>{e.style.display=e.getAttribute("data-announcement-type-help")===this.element.value?"block":"none"}))}}class Fe{constructor(e){this.button=e,this.confirmMessage=e.dataset.confirm,this.onClick=this.onClick.bind(this),this.button.addEventListener("click",this.onClick)}onClick(e){confirm(this.confirmMessage)||e.preventDefault()}}class Ne{constructor(e,t){this.notificationRadios=e,this.dependentRadios=t,this.dependentRadios.forEach((e=>{e.addEventListener("change",(()=>{this.refresh()}))})),this.notificationRadios.getAttribute("data-user-redactor")||this.refresh()}refresh(){let e={};this.dependentRadios.forEach((t=>{t.id==="entity_manage_autoPublishParentsAlert_"+t.id.match(/\d+/)[0]&&Object.defineProperty(e,"inputAlert",{value:t}),t.id==="entity_manage_autoPublishParentsMessage_"+t.id.match(/\d+/)[0]&&(Object.defineProperty(e,"inputMessage",{value:t}),Object.defineProperty(e,"inputNotif",{value:this.notificationRadios}))})),e.inputAlert.checked&&e.inputMessage.checked&&(e.inputNotif.checked=!1,e.inputNotif.setAttribute("disabled","true")),e.inputNotif.getAttribute("disabled","true")&&(!1!==e.inputAlert.checked&&!1!==e.inputMessage.checked||(e.inputNotif.disabled=!1))}}i(3029);class Re{constructor(e){this.btn=e,this.btn.addEventListener("click",this.fetchUrlResetPassword.bind(this))}fetchUrlResetPassword(){const e={email:this.btn.getAttribute("data-fetch-url-reset-password")};fetch("/admin/reset-password",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{let{url:t}=e;this.copyToClipboard(t)})).catch((e=>{console.error(e)}))}copyToClipboard(e){navigator.clipboard.writeText(e).then((()=>{this.displayTooltip()})).catch((e=>{console.error(e)}))}displayTooltip(){r()(this.btn).tooltip({trigger:"manual",title:"Copié !",placement:"bottom"}),r()(this.btn).tooltip("show"),setTimeout((()=>{r()(this.btn).tooltip("hide")}),1300)}}class Oe{constructor(e){this.container=e,this.input=this.container.querySelector("input"),this.toggleButton=this.container.querySelector(".toggle-password-visibility"),this.icon=this.toggleButton.querySelector("i"),this.toggleVisibility=this.toggleVisibility.bind(this),this.toggleButton.addEventListener("click",this.toggleVisibility)}toggleVisibility(){"password"===this.input.getAttribute("type")?(this.input.setAttribute("type","text"),this.icon.setAttribute("class","fa fa-eye")):(this.input.setAttribute("type","password"),this.icon.setAttribute("class","fa fa-eye-slash"))}}class He{constructor(e){this.checkbox=e.querySelector("#form-sign-fieldset-checkbox input[type='checkbox']"),this.fieldset=e.querySelector(".fieldset-form-sign"),this.helpText=e.querySelector(".help-text"),this.onClick=this.onClick.bind(this),this.checkbox.addEventListener("click",this.onClick),this.fieldset.classList.toggle("d-none",!this.checkbox.checked),this.helpText&&this.helpText.classList.toggle("d-none",this.checkbox.checked),this.disabledFieldset()}onClick(){this.fieldset.classList.toggle("d-none",!this.checkbox.checked),this.helpText&&this.helpText.classList.toggle("d-none",this.checkbox.checked),this.disabledFieldset()}disabledFieldset(){this.checkbox.checked?this.fieldset.removeAttribute("disabled"):this.fieldset.setAttribute("disabled","disabled")}}class je{constructor(e,t){this.fieldDayPeriod=t,this.fieldStartAt=e,this.startAtValue=this.fieldStartAt.value,this.options=this.fieldDayPeriod.querySelectorAll("option"),this.init()}init(){const e=this.fieldDayPeriod.hasAttribute("data-edit-sign"),t=new Date;e?this.startAtValue===t.toISOString().split("T")[0]&&t.getHours()>=13&&(r()(this.fieldDayPeriod).empty(),r()(this.fieldDayPeriod).append(this.options[1])):this.changeOptions(this.startAtValue,t),this.fieldStartAt.addEventListener("change",(e=>{this.changeOptions(e.target.value,t)}))}changeOptions(e,t){r()(this.fieldDayPeriod).empty(),e===t.toISOString().split("T")[0]&&t.getHours()>=13?r()(this.fieldDayPeriod).append(this.options[1]):r()(this.fieldDayPeriod).append(this.options),this.fieldDayPeriod.selectedIndex=0}}var Ve=i(1454);class Ue{constructor(){this.ppPlusModal=document.querySelectorAll("#join_panneaupocket_plus_modal"),this.openModal=this.openModal.bind(this),document.querySelectorAll("#module_pp_modal").forEach((e=>{e.addEventListener("click",(t=>this.openModal(e.getAttribute("data-modal-type"),t)))}))}openModal(e,t){t.preventDefault(),t.stopPropagation(),this.ppPlusModal.forEach((t=>{e===t.getAttribute("data-modal-type")&&r()(t).modal("show")}))}}var ze,We;i(8124),i(8921),i(6859),i(877),i(2741),i(3985),i(5891),i(1845),i(9465),i(8324);ze=r(),We={},ze.extend(!0,ze.trumbowyg,{langs:{en:{tel:"Téléphone"}},plugins:{tel:{init:function(e){e.o.plugins.tel=ze.extend(!0,{},We,e.o.plugins.tel||{}),function(){if(ze("#trumbowyg-tel").length>0)return;const e=ze(document.createElementNS("http://www.w3.org/2000/svg","svg"));e.addClass("trumbowyg-icons"),e.html('\n            <symbol id="trumbowyg-tel" viewBox="0 0 24 24">\n                <path d="M21 16.42V19.9561C21 20.4811 20.5941 20.9167 20.0705 20.9537C19.6331 20.9846 19.2763 21 19 21C10.1634 21 3 13.8366 3 5C3 4.72371 3.01545 4.36687 3.04635 3.9295C3.08337 3.40588 3.51894 3 4.04386 3H7.5801C7.83678 3 8.05176 3.19442 8.07753 3.4498C8.10067 3.67907 8.12218 3.86314 8.14207 4.00202C8.34435 5.41472 8.75753 6.75936 9.3487 8.00303C9.44359 8.20265 9.38171 8.44159 9.20185 8.57006L7.04355 10.1118C8.35752 13.1811 10.8189 15.6425 13.8882 16.9565L15.4271 14.8019C15.5572 14.6199 15.799 14.5573 16.001 14.6532C17.2446 15.2439 18.5891 15.6566 20.0016 15.8584C20.1396 15.8782 20.3225 15.8995 20.5502 15.9225C20.8056 15.9483 21 16.1633 21 16.42Z"></path>\n            </symbol>\n        ').appendTo(document.body)}(),e.addBtnDef("tel",function(e){return{fn:function(){for(var t,i=e.doc.getSelection(),s=i.focusNode;["A","DIV"].indexOf(s.nodeName)<0;)s=s.parentNode;if(s&&"A"===s.nodeName){t=ze(s).attr("href");var n=e.doc.createRange();n.selectNode(s),i.removeAllRanges(),i.addRange(n)}e.saveRange(),e.openModalInsert("Entrer un numéro de téléphone :",{tel:{value:void 0!==t?t.replace("tel://",""):""}},(function(t){var i=ze(['<a href="tel://',t.tel,'">',t.tel,"</a>"].join(""));return e.range.deleteContents(),e.range.insertNode(i[0]),e.syncCode(),e.$c.trigger("tbwchange"),!0}))}}}(e))},tagHandler:function(e){return"A"===e.tagName&&e.getAttribute("href").startsWith("tel://")?["tel"]:[]}}}}),function(e){var t={};e.extend(!0,e.trumbowyg,{langs:{en:{mail:"Email"}},plugins:{mail:{init:function(i){i.o.plugins.mail=e.extend(!0,{},t,i.o.plugins.mail||{}),function(){if(e("#trumbowyg-mail").length>0)return;const t=e(document.createElementNS("http://www.w3.org/2000/svg","svg"));t.addClass("trumbowyg-icons"),t.html('\n            <symbol id="trumbowyg-mail" viewBox="0 0 24 24">\n                <path d="M3 3H21C21.5523 3 22 3.44772 22 4V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V4C2 3.44772 2.44772 3 3 3ZM20 7.23792L12.0718 14.338L4 7.21594V19H20V7.23792ZM4.51146 5L12.0619 11.662L19.501 5H4.51146Z"></path>\n            </symbol>\n        ').appendTo(document.body)}(),i.addBtnDef("mail",function(t){return{fn:function(){for(var i,s=t.doc.getSelection(),n=s.focusNode;["A","DIV"].indexOf(n.nodeName)<0;)n=n.parentNode;if(n&&"A"===n.nodeName){i=e(n).attr("href");var o=t.doc.createRange();o.selectNode(n),s.removeAllRanges(),s.addRange(o)}t.saveRange(),t.openModalInsert("Entrer une adresse email :",{mail:{value:void 0!==i?i.replace("mailto://",""):""}},(function(i){var s=e(['<a href="mailto:',i.mail,'">',i.mail,"</a>"].join(""));return t.range.deleteContents(),t.range.insertNode(s[0]),t.syncCode(),t.$c.trigger("tbwchange"),!0}))}}}(i))},tagHandler:function(e){return"A"===e.tagName&&e.getAttribute("href").startsWith("mailto://")?["mail"]:[]}}}})}(r()),function(e){var t={serverPath:"",fileFieldName:"fileToUpload",data:[],headers:{},xhrFields:{},urlPropertyName:"file",statusPropertyName:"success",success:void 0,error:void 0,imageWidthModalEdit:!1};e.extend(!0,e.trumbowyg,{langs:{en:{pdfUpload:"Upload a PDF file",pdfFile:"PDF File",uploadPdfError:"Size max. 3MB"},fr:{pdf:"Fichier PDF",pdfUpload:"Ajouter un fichier PDF",pdfFile:"Fichier PDF",uploadPdfError:"Taille max 3MB"}},plugins:{pdf:{init:function(i){i.o.plugins.pdf=e.extend(!0,{},t,i.o.plugins.pdf||{}),function(){if(e("#trumbowyg-pdf").length>0)return;const t=e(document.createElementNS("http://www.w3.org/2000/svg","svg"));t.addClass("trumbowyg-icons"),t.html('\n            <symbol id="trumbowyg-pdf" viewBox="0 0 24 24">\n                <path d="M5 4H15V8H19V20H5V4ZM3.9985 2C3.44749 2 3 2.44405 3 2.9918V21.0082C3 21.5447 3.44476 22 3.9934 22H20.0066C20.5551 22 21 21.5489 21 20.9925L20.9997 7L16 2H3.9985ZM10.4999 7.5C10.4999 9.07749 10.0442 10.9373 9.27493 12.6534C8.50287 14.3757 7.46143 15.8502 6.37524 16.7191L7.55464 18.3321C10.4821 16.3804 13.7233 15.0421 16.8585 15.49L17.3162 13.5513C14.6435 12.6604 12.4999 9.98994 12.4999 7.5H10.4999ZM11.0999 13.4716C11.3673 12.8752 11.6042 12.2563 11.8037 11.6285C12.2753 12.3531 12.8553 13.0182 13.5101 13.5953C12.5283 13.7711 11.5665 14.0596 10.6352 14.4276C10.7999 14.1143 10.9551 13.7948 11.0999 13.4716Z"></path>\n            </symbol>\n        ').appendTo(document.body)}();var s={fn:function(){i.saveRange();var t,s=i.o.prefix,n=!1,o=i.openModalInsert(i.lang.pdfUpload,{pdfFile:{type:"file",required:!0,attributes:{accept:"application/pdf"}}},(function(a){const r=i.o.plugins.pdf;if(!n){n=!0;var l=new FormData;l.append(r.fileFieldName,t),r.data.map((function(e){l.append(e.name,e.value)})),e.map(a,(function(e,t){"pdfFile"!==t&&l.append(t,e)})),0===e("."+s+"progress",o).length&&e("."+s+"modal-title",o).after(e("<div/>",{class:s+"progress"}).append(e("<div/>",{class:s+"progress-bar"}))),function(e,t,i){var s=new XMLHttpRequest;s.open("POST",e,!0),Object.keys(i.headers).forEach((e=>{s.setRequestHeader(e,i.headers[e])})),Object.keys(i.xhrFields).forEach((e=>{s[e]=i.headers[e]})),s.upload.addEventListener("progress",(function(e){i.progress(e)}),!1),s.onreadystatechange=function(){if(4===s.readyState){if((s.status<200||s.status>=300)&&304!==s.status)return i.error(),void(s=null);var e=JSON.parse(s.responseText);i.success(e),s=null}},s.send(t)}(r.serverPath,l,{headers:r.headers,xhrFields:r.xhrFields,progress:function(t){e("."+s+"progress-bar").css("width",Math.round(100*t.loaded/t.total)+"%")},success:function(t){if(n=!1,r.success)r.success(t,i,o,a);else{if(t.status)return i.addErrorOnModalField(e("input[type=file]",o),i.lang[t.message]),void i.$c.trigger("tbwuploaderror",[i,t]);var s=t.url,l=t.thumbnail;i.execCmd("insertHTML",'<img src="'+l+'"/>'),setTimeout((function(){i.closeModal()}),250),i.$c.trigger("tbwuploadsuccess",[i,t,s])}},error:r.error||function(){i.addErrorOnModalField(e("input[type=file]",o),i.lang.uploadPdfError),i.$c.trigger("tbwuploaderror",[i]),n=!1}})}}));e("input[type=file]").on("change",(function(e){t=e.target.files[0]}))}};i.addBtnDef("pdf",s)}}}})}(r()),function(e){e.extend(!0,e.trumbowyg,{plugins:{nopaste:{init:function(e){e.pasteHandlers.push((function(e){for(var t=(e.originalEvent||e).clipboardData.items,i=t.length-1;i>=0;i-=1)"file"===t[i].kind&&(e.preventDefault(),e.stopPropagation())}))}}}})}(r());var $e=i(4665);const Je=document.querySelector("#modele_module_content"),Ye=document.querySelector("#module_content");let Xe;if(r().extend(!0,r().trumbowyg.langs.fr,{strong:"Gras",em:"Italique",del:"Barré",noembed:"Vidéo",emoji:"Emoji",upload:"Image",file:"Fichier",fontFamily:"Police",fontsize:"Taille de la police",foreColor:"Couleur du texte",backColor:"Couleur de fond",foreColorRemove:"Supprimer la couleur du texte",backColorRemove:"Supprimer la couleur de fond",align:"Aligner le texte",list:"Liste ordonnée / à puces",table:"Insérer un tableau",tableRows:"Lignes",tableColumns:"Colonnes",tableVerticalAlign:"Alignement vertical",tableOthers:"Autres",tableAddHeaderRow:"Insérer une line d'en-tête",tableAddRowAbove:"Insérer une ligne au dessus",tableAddRow:"Insérer une ligne en dessous",tableAddColumnLeft:"Insérer une colonne à gauche",tableAddColumn:"Insérer une colonne à droite",tableDeleteRow:"Supprimer la ligne",tableDeleteColumn:"Supprimer la colonne",tableDestroy:"Supprimer le tableau",tableMergeCells:"Fusionner les cellules",tableUnmergeCells:"Dissocier les cellules",tableVerticalAlignTop:"Aligner en haut",tableVerticalAlignMiddle:"Aligner au milieu",tableVerticalAlignBottom:"Aligner en bas",tableCellBackgroundColor:"Couleur de fond des cellules",tableBorderColor:"Couleur de la bordure du tableau",uploadError:"Taille max 3Mo"}),Je&&(r().trumbowyg.svgPath=$e,r()(Je).trumbowyg({resetCss:!0,minimalLinks:!0,lang:"fr",semantic:!1,btnsDef:{align:{dropdown:["justifyLeft","justifyCenter","justifyRight","justifyFull"],ico:"justifyLeft"},list:{dropdown:["orderedList","unorderedList"],ico:"orderedList"},upload:{ico:"insertImage"},strong:{ico:"gras"}},btns:[["historyUndo","historyRedo"],["fontfamily","fontsize"],["foreColor","backColor"],["strong","em","underline"],["link","tel","mail","emoji"],["upload","noembed","pdf"],["align","list","horizontalRule"],["table"],["tableCellBackgroundColor","tableBorderColor"],["removeformat"]],plugins:{colors:{colorList:["ff0000","ff5e00","ffe400","abf200","00d8ff","0055ff","6600ff","ff00dd","000000","ffd8d8","fae0d4","faf4c0","e4f7ba","d4f4fa","d9e5ff","e8d9ff","ffd9fa","f1f1f1","ffa7a7","ffc19e","faed7d","cef279","b2ebf4","b2ccff","d1b2ff","ffb2f5","bdbdbd","f15f5f","f29661","e5d85c","bce55c","5cd1e5","6699ff","a366ff","f261df","8c8c8c","980000","993800","998a00","6b9900","008299","003399","3d0099","990085","353535","670000","662500","665c00","476600","005766","002266","290066","660058","222222"],allowCustomForeColor:!0,allowCustomBackColor:!0},fontfamily:{fontList:[{name:"Arial",family:"Arial"},{name:"Courrier",family:"Courrier"},{name:"poppins regular",family:"poppins regular"}]},fontsize:{allowCustomSize:!1,sizeList:["14px","16px","18px","20px","22px","24px","26px","28px"]},upload:{serverPath:"/admin/module/image/upload",urlPropertyName:"url",success:function(e,t,i){const s=e.url+"?t="+Date.now();t.saveRange();const n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const o=new Image;o.onload=()=>{t.$c.focus(),t.restoreRange();const e='<p><img src="'.concat(s,'" /></p>');t.execCmd("insertHTML",e),t.syncCode(),t.$c.trigger("tbwchange"),t.closeModal(),t.$box.find(".trumbowyg-button").removeClass("trumbowyg-disable")},o.onerror=()=>{e>0?setTimeout((()=>n(e-1)),300):t.addErrorOnModalField(i,"Erreur de chargement de l’image.")},o.src=s};n()}},pdf:{serverPath:"/admin/module/image/upload-pdf",urlPropertyName:"url",success:function(e,t,i){const s=e.url+"?t="+Date.now(),n=e.thumbnail+"?t="+Date.now();t.saveRange();const o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const a=new Image;a.onload=()=>{t.$c.focus(),t.restoreRange();const e='<p><a href="'.concat(s,'" target="_blank"><img src="').concat(n,'" /></a></p>');t.execCmd("insertHTML",e),t.syncCode(),t.$c.trigger("tbwchange"),t.closeModal(),t.$box.find(".trumbowyg-button").removeClass("trumbowyg-disable")},a.onerror=()=>{e>0?setTimeout((()=>o(e-1)),300):t.addErrorOnModalField(i,"Erreur de chargement de l’image.")},a.src=n};o()}},table:{allowHorizontalResize:!0,colorList:["ff0000","ff5e00","ffe400","abf200","00d8ff","0055ff","6600ff","ff00dd","000000","ffd8d8","fae0d4","faf4c0","e4f7ba","d4f4fa","d9e5ff","e8d9ff","ffd9fa","f1f1f1","ffa7a7","ffc19e","faed7d","cef279","b2ebf4","b2ccff","d1b2ff","ffb2f5","bdbdbd","f15f5f","f29661","e5d85c","bce55c","5cd1e5","6699ff","a366ff","f261df","8c8c8c","980000","993800","998a00","6b9900","008299","003399","3d0099","990085","353535","670000","662500","665c00","476600","005766","002266","290066","660058","222222"]},noembed:{proxy:"https://noembed.com/embed?nowrap=on&maxwidth=260",success:function(e,t,i){e.url.includes("www.youtube")?(t.execCmd("insertHTML",e.html),setTimeout((function(){t.closeModal()}),250)):t.addErrorOnModalField(r()("input[type=text]",i),"Uniquement Youtube")}}}})),Ye&&(Ye.defaultValue=Ye.defaultValue.replace("mailto://","mailto:"),r().trumbowyg.svgPath=$e,r()(Ye).trumbowyg({resetCss:!0,minimalLinks:!0,semantic:!1,lang:"fr",btnsDef:{align:{dropdown:["justifyLeft","justifyCenter","justifyRight","justifyFull"],ico:"justifyLeft"},list:{dropdown:["orderedList","unorderedList"],ico:"orderedList"},upload:{ico:"insertImage"},strong:{ico:"gras"}},btns:[["historyUndo","historyRedo"],["fontfamily","fontsize"],["foreColor","backColor"],["strong","em"],["link","tel","mail","emoji"],["upload","noembed","pdf"],["align","list","horizontalRule"],["removeformat"]],plugins:{colors:{colorList:["ff0000","ff5e00","ffe400","abf200","00d8ff","0055ff","6600ff","ff00dd","000000","ffd8d8","fae0d4","faf4c0","e4f7ba","d4f4fa","d9e5ff","e8d9ff","ffd9fa","f1f1f1","ffa7a7","ffc19e","faed7d","cef279","b2ebf4","b2ccff","d1b2ff","ffb2f5","bdbdbd","f15f5f","f29661","e5d85c","bce55c","5cd1e5","6699ff","a366ff","f261df","8c8c8c","980000","993800","998a00","6b9900","008299","003399","3d0099","990085","353535","670000","662500","665c00","476600","005766","002266","290066","660058","222222"],allowCustomForeColor:!0,allowCustomBackColor:!0},fontfamily:{fontList:[{name:"Arial",family:"Arial"},{name:"Courrier",family:"Courrier"},{name:"poppins regular",family:"poppins regular"}]},fontsize:{allowCustomSize:!1,sizeList:["14px","16px","18px","20px","22px","24px","26px","28px"]},upload:{serverPath:"/admin/module/image/upload",urlPropertyName:"url",success:function(e,t,i){const s=e.url+"?t="+Date.now();t.saveRange();const n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const o=new Image;o.onload=()=>{t.$c.focus(),t.restoreRange();const e='<p><img src="'.concat(s,'" /></p>');t.execCmd("insertHTML",e),t.syncCode(),t.$c.trigger("tbwchange"),t.closeModal(),t.$box.find(".trumbowyg-button").removeClass("trumbowyg-disable")},o.onerror=()=>{e>0?setTimeout((()=>n(e-1)),300):t.addErrorOnModalField(i,"Erreur de chargement de l’image.")},o.src=s};n()}},pdf:{serverPath:"/admin/module/image/upload-pdf",urlPropertyName:"url",success:function(e,t,i){const s=e.url+"?t="+Date.now(),n=e.thumbnail+"?t="+Date.now();t.saveRange();const o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const a=new Image;a.onload=()=>{t.$c.focus(),t.restoreRange();const e='<p><a href="'.concat(s,'" target="_blank"><img src="').concat(n,'" /></a></p>');t.execCmd("insertHTML",e),t.syncCode(),t.$c.trigger("tbwchange"),t.closeModal(),t.$box.find(".trumbowyg-button").removeClass("trumbowyg-disable")},a.onerror=()=>{e>0?setTimeout((()=>o(e-1)),300):t.addErrorOnModalField(i,"Erreur de chargement de l’image.")},a.src=n};o()}},noembed:{proxy:"https://noembed.com/embed?nowrap=on&maxwidth=260",success:function(e,t,i){e.url.includes("www.youtube")?(t.execCmd("insertHTML",e.html),setTimeout((function(){t.closeModal()}),250)):t.addErrorOnModalField(r()("input[type=text]",i),"Uniquement Youtube")}}}})),0===r()("#trumbowyg-gras").length){const e=r()(document.createElementNS("http://www.w3.org/2000/svg","svg"));e.addClass("trumbowyg-icons"),e.html('\n        <symbol id="trumbowyg-gras" viewBox="0 0 24 24">\n            <text style="font-size: 16pt;font-family: sans-serif;font-weight: 700" y="20">G</text>\n        </symbol>\n    ').appendTo(document.body)}r()(Ye).trumbowyg().on("tbwchange keydown keypress",(function(){const e=document.querySelector(".trumbowyg-upload-button"),t=document.querySelector(".trumbowyg-noembed-button"),i=document.querySelector(".trumbowyg-pdf-button");let s=r()(Ye).trumbowyg("html");s=s.replace(/(<([^>]+)>)/gi,""),s=s.replace(/&[^;]+;/g," "),s.length>4e4&&r()(Ye).trumbowyg("html",s.substring(0,4e4));let n=(new DOMParser).parseFromString(r()(Ye).trumbowyg("html"),"text/html"),o=n.querySelectorAll("img"),a=n.querySelectorAll("iframe");if(o.length>=20?(r()(e).addClass("trumbowyg-disable"),r()(i).addClass("trumbowyg-disable")):(r()(e).removeClass("trumbowyg-disable"),r()(i).removeClass("trumbowyg-disable")),a.length>=20?r()(t).addClass("trumbowyg-disable"):r()(t).removeClass("trumbowyg-disable"),o.length>20){for(let e=21;e<=o.length;e++){const t=o[e-1];t.parentNode.removeChild(t)}r()(Ye).trumbowyg("html",n.documentElement.outerHTML),Xe||(Xe=r()(Ye).trumbowyg("openModal",{title:"Vous avez atteint le nombre maximal d'images pour ce module !"}));const e=document.querySelector(".trumbowyg-modal-reset"),t=document.querySelector(".trumbowyg-modal-submit"),i=document.querySelector(".trumbowyg-modal-box"),s=document.querySelector(".trumbowyg-modal-title");r()(e).addClass("modal-button-reset"),r()(t).addClass("modal-button-validate"),r()(t).text("Continuer"),r()(i).addClass("modal-box"),r()(s).addClass("modal-title"),Xe.on("tbwconfirm",(function(){r()(Ye).trumbowyg("closeModal"),Xe=void 0})),Xe.on("tbwcancel",(function(){r()(Ye).trumbowyg("closeModal"),Xe=void 0})),setTimeout((()=>{r()(Ye).trumbowyg("closeModal"),Xe=void 0}),3e3)}}));class Ze{constructor(){this.startPublication=document.querySelector("#sign_startAt"),this.endPublication=document.querySelector("#sign_endAt"),this.nbDays=document.querySelector("#day"),this.init()}init(){this.changeDayInterval(),this.startPublication.addEventListener("change",(()=>this.changeDayInterval())),this.endPublication.addEventListener("change",(()=>this.changeDayInterval()))}changeDayInterval(){const e=new Date(this.startPublication.value),t=new Date(this.endPublication.value);let i;i=e<=t?(t-e)/864e5+1:32,this.nbDays.innerHTML="".concat(i,1===i?" jour":" jours")}}class Qe{constructor(e,t){this.notificationRadios=e,this.dependentRadios=t,this.dependentRadios.forEach((e=>{e.addEventListener("change",(()=>{this.refresh()}))})),this.notificationRadios.getAttribute("data-user-redactor")||this.refresh()}refresh(){let e={};this.dependentRadios.forEach((t=>{t.id==="entity_manage_tokenAutomaticDiffusion_"+t.id.match(/\d+/)[0]&&(Object.defineProperty(e,"inputDiffusion",{value:t}),Object.defineProperty(e,"inputNotif",{value:this.notificationRadios}))})),e.inputDiffusion.checked&&(e.inputNotif.checked=!1,e.inputNotif.setAttribute("disabled","true")),e.inputNotif.getAttribute("disabled","true")&&!1===e.inputDiffusion.checked&&(e.inputNotif.disabled=!1)}}class Ke{constructor(e){this.fileInput=e,this.fileInput&&this.init()}init(){this.fileInput.addEventListener("change",(e=>this.handleFileChange(e)))}handleFileChange(e){const t=e.target.files[0];if(t){const e=new Image;e.src=URL.createObjectURL(t),e.onload=()=>{const t=e.width,i=e.height;t>250||i>250?(this.fileInput.setCustomValidity("Image taille max 250x250"),this.fileInput.reportValidity(),this.fileInput.value=""):this.fileInput.setCustomValidity("")}}}}class Ge{constructor(e){this.inputColor=e.querySelector('input[type="color"]'),this.color=this.inputColor.value,this.inputText=e.querySelector("#widget_config_color"),this.inputColor.addEventListener("change",(e=>{this.inputText.value=e.target.value})),this.inputText.addEventListener("change",(e=>{this.inputColor.value=e.target.value,this.inputColor.value!==e.target.value.toLowerCase()?this.inputColor.value=this.color:this.color=e.target.value}))}}class et{constructor(e,t){this.widgetConfig=e,this.widgetIframe=t,this.buttons=document.querySelectorAll("a.trigger-loader"),this.modal=document.getElementById("confirm-form-quit-modal"),this.buttonQuitModal=this.modal.querySelector("[data-quit-form-yes]"),this.entityId=this.widgetConfig.getAttribute("data-entity-id"),this.widgetConfigId=this.widgetConfig.getAttribute("data-widget-id"),this.init()}init(){this.title=this.widgetConfig.querySelector("#widget_config_title"),this.hideTitle=this.widgetConfig.querySelector("#widget_config_hideTitle"),this.fluxAlert=this.widgetConfig.querySelector("#widget_config_fluxAlert"),this.fluxInfo=this.widgetConfig.querySelector("#widget_config_fluxInfo"),this.color=this.widgetConfig.querySelector("#widget_config_color"),this.autoScroll=this.widgetConfig.querySelector("#widget_config_autoScroll"),this.colorBlock=this.widgetConfig.querySelector(".widget-color"),this.buttonUpdate=this.widgetConfig.querySelector("#widget_config_update"),this.widgetObject={title:this.title.value,hideTitle:this.hideTitle.checked,fluxAlert:this.fluxAlert.checked,fluxInfo:this.fluxInfo.checked,color:this.color.value,autoScroll:this.autoScroll.value},this.newWidgetObject={...this.widgetObject},this.title.addEventListener("change",(e=>{this.newWidgetObject.title=e.target.value})),this.color.addEventListener("change",(e=>{this.colorBlock.value=e.target.value,this.colorBlock.value!==this.color.value.toLowerCase()?(this.colorBlock.value=this.newWidgetObject.color,this.color.value=this.newWidgetObject.color):this.newWidgetObject.color=this.color.value})),this.colorBlock.addEventListener("change",(e=>{this.newWidgetObject.color=e.target.value})),this.hideTitle.addEventListener("click",(e=>{this.newWidgetObject.hideTitle=e.target.checked})),this.fluxAlert.addEventListener("click",(e=>{this.newWidgetObject.fluxAlert=e.target.checked})),this.fluxInfo.addEventListener("click",(e=>{this.newWidgetObject.fluxInfo=e.target.checked})),this.autoScroll.addEventListener("change",(e=>{this.newWidgetObject.autoScroll=e.target.value})),this.buttonUpdate.addEventListener("click",(e=>{e.preventDefault(),this.save(this.newWidgetObject,!0)})),this.buttons.forEach((e=>{e.addEventListener("click",(async t=>{this.buttonHref=e.href,t.preventDefault(),JSON.stringify(this.newWidgetObject)===JSON.stringify(this.widgetObject)&&""===this.widgetObject.title?(await this.removeWidgetConfig(),window.location.href=this.buttonHref):JSON.stringify(this.newWidgetObject)===JSON.stringify(this.widgetObject)&&(await this.save(this.widgetObject,!1),window.location.href=this.buttonHref)}))})),this.buttonQuitModal.addEventListener("click",(async e=>{e.preventDefault(),""===this.widgetObject.title?(await this.removeWidgetConfig(),window.location.href=this.buttonHref):(await this.save(this.widgetObject,!1),window.location.href=this.buttonHref)}))}save(e,t){const i={method:"POST",body:JSON.stringify(e)};fetch("/admin/".concat(this.entityId,"/widget/config/").concat(this.widgetConfigId,"/save"),i).then((()=>{if(t)return this.reloadIframe()}))}reloadIframe(){this.iframe=this.widgetIframe.querySelector("iframe");const e=this.iframe.src;this.iframe.src=e}removeWidgetConfig(){const e={method:"POST",body:JSON.stringify(this.widgetObject)};fetch("/admin/".concat(this.entityId,"/widget/config/").concat(this.widgetConfigId,"/remove"),e)}}class tt{constructor(e,t,i){this.idAcFiche=e,this.idAcFicheArray=t,this.acIframe=i,this.draggedRow=null,this.hasLoad=!1,this.entityId=this.acIframe.dataset.entityId,this.init()}init(){this.updateIdAcFicheTable(),this.acIframe&&!this.hasLoad&&this.acIframe.addEventListener("load",(()=>{this.hasLoad||(window.addEventListener("message",this.handleIframeMessage.bind(this)),this.hasLoad=!0)}))}handleIframeMessage(e){if("add_directory"===e.data.type){const t=e.data.data.id.toString().trim(),i=this.idAcFiche.value?this.idAcFiche.value.split(",").map((e=>e.trim())).filter((e=>""!==e)):[];i.includes(t)||(i.push(t),this.idAcFiche.value=i.join(", ")),this.updateIdAcFicheTable(),this.closeDirecoryIframe()}"update_directory"===e.data.type&&(this.updateIdAcFicheTable(),this.closeDirecoryIframe())}closeDirecoryIframe(){document.getElementById("sheet-modal").style.display="none";const e=document.getElementById("ac-sheet");e.src=e.dataset.defaultUrl,document.getElementById("sheet-title").textContent="Création d'une page annuaire"}updateIdAcFicheTable(){const e=this.idAcFiche.value.split(",").map((e=>e.trim())).filter((e=>""!==e));if(this.idAcFicheArray.innerHTML="",0===e.length){const e=document.createElement("tr");e.style.height="200px";const t=document.createElement("td");t.colSpan=6,t.className="text-center",t.textContent="Votre annuaire est vide. Ajoutez une nouvelle fiche !",e.appendChild(t),this.idAcFicheArray.appendChild(e)}else e.forEach(((t,i)=>this.createRow(t,i,e)))}fetchDirectoryDetails(e){const t=window.location.origin,i="".concat(t,"/api/entity/").concat(this.entityId,"/attractive-city-directory/").concat(e);return fetch(i).then((e=>{if(!e.ok)throw new Error("Erreur ".concat(e.status,": Impossible de charger les données. ").concat(e.statusText));return e.json()})).catch((e=>(console.error("Erreur lors de la récupération des données:",e),null)))}createRow(e,t,i){const s=document.createElement("tr");s.setAttribute("draggable",!0),s.dataset.index=t,s.dataset.id=e;const n=document.createElement("td");n.style.width="1%",n.style.whiteSpace="nowrap";const o=document.createElement("i");o.className="fas fa-bars",o.setAttribute("aria-hidden","true"),n.appendChild(o);const a=document.createElement("td");a.style.textOverflow="ellipsis",a.style.overflow="hidden",a.style.whiteSpace="nowrap",a.style.maxWidth="300px",a.textContent="Chargement...";const r=document.createElement("td");r.textContent="";const l=document.createElement("td");l.textContent="";const d=document.createElement("td");d.textContent="Chargement...",this.fetchDirectoryDetails(e).then((e=>{if(e&&e.title){a.textContent=e.title,r.textContent=e.type.title,l.textContent=e.category.title,d.innerHTML="";let t=null,i="Image fiche";e.medias.length>0?(t=e.medias[0].path,i=e.medias[0].title):(t=e.category.image,i=e.category.title);const s=document.createElement("img");s.src=t,s.alt=i,s.style.maxWidth="60px",s.style.maxHeight="60px",d.style.paddingTop="0px",d.style.paddingBottom="0px",d.appendChild(s)}else a.textContent="Titre non disponible",r.textContent="Type non disponible",l.textContent="Catégorie non disponible"}));const c=document.createElement("td"),h=this.createActionButton("btn-primary btn-edit","fas fa-pencil-alt",(()=>{const t=this.acIframe.dataset.defaultUrl.replace("new",e);this.acIframe.src=t,document.getElementById("sheet-modal").style.display="flex";document.getElementById("sheet-title").textContent="Modification d'une page annuaire"}));h.style.marginRight="8px";const u=this.createActionButton("btn-secondary btn-duplicate","fas fa-clone",(()=>{this.duplicateDirectory(e)}));u.style.marginRight="8px";const m=this.createActionButton("btn-danger btn-delete","fas fa-archive",(()=>{i.splice(t,1),this.idAcFiche.value=i.join(","),this.updateIdAcFicheTable()}));c.appendChild(h),c.appendChild(u),c.appendChild(m),s.appendChild(n),s.appendChild(a),s.appendChild(r),s.appendChild(l),s.appendChild(d),s.appendChild(c),this.addDragEvents(s),this.idAcFicheArray.appendChild(s)}createActionButton(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=document.createElement("a");s.className="btn ".concat(e),i&&s.addEventListener("click",i);const n=document.createElement("i");return n.className=t,n.setAttribute("aria-hidden","true"),s.appendChild(n),s}addDragEvents(e){e.addEventListener("dragstart",(t=>{this.draggedRow=e,t.dataTransfer.effectAllowed="move"})),e.addEventListener("dragover",(e=>{e.preventDefault();const t=e.target.closest("tr");t&&t!==this.draggedRow&&this.idAcFicheArray.insertBefore(this.draggedRow,t.nextSibling)})),e.addEventListener("dragend",(()=>{this.draggedRow=null;const e=Array.from(this.idAcFicheArray.querySelectorAll("tr")).map((e=>e.dataset.id)).filter((e=>void 0!==e&&""!==e));this.idAcFiche.value=e.join(",")}))}duplicateDirectory(e){const t=window.location.origin,i="".concat(t,"/api/entity/").concat(this.entityId,"/attractive-city-directory/").concat(e,"/duplicate");fetch(i,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw new Error("Erreur lors de la duplication : ".concat(e.statusText));return e.json()})).then((e=>{const t=e.id,i=this.idAcFiche.value.split(",");i.includes(t)||(i.push(t),this.idAcFiche.value=i.join(","),this.updateIdAcFicheTable());const s=this.acIframe.dataset.defaultUrl.replace("new",t);this.acIframe.src=s;document.getElementById("sheet-modal").style.display="flex"})).catch((e=>{console.error("Erreur lors de la duplication de la fiche :",e)}))}}class it{constructor(e){this.directoryListAc=e,this.idsDirectory=document.getElementById("module_annuaire_directory_ids_directory"),this.submitDelete=document.getElementById("module_annuaire_directory_submit"),this.init()}init(){this.directoryListAc.addEventListener("load",(()=>{window.addEventListener("message",this.handleIframeMessage.bind(this))}))}handleIframeMessage(e){"delete_directory"===e.data.type&&(this.idsDirectory.value=e.data.data.idsRemoved,this.submitDelete.click())}}var st=i(7576),nt=i.n(st);class ot{constructor(e,t){const i=e.getAttribute("data-tooltip"),s=new(nt())(e,{text:()=>t.value,container:e.parentNode});r()(e).tooltip({trigger:"manual",title:i}),s.on("success",(()=>{r()(e).tooltip("show"),setTimeout((()=>r()(e).tooltip("hide")),2e3)}))}}class at{constructor(e,t,i){this.buttonToDeleteElement=t,this.linkToDeleteElement=e,this.deleteElementModal=document.getElementById("confirm-delete-modal"),this.forms=document.querySelectorAll("form[data-controller]"),this.element=i,this.deleteWithLink=this.deleteWithLink.bind(this),this.deleteWithButton=this.deleteWithButton.bind(this),this.displayOrHidePlural=this.displayOrHidePlural.bind(this),this.onPageLeave=this.onPageLeave.bind(this),this.serializeForm=this.serializeForm.bind(this),this.init()}init(){0!==this.linkToDeleteElement.length&&this.linkToDeleteElement.forEach((e=>{e.addEventListener("click",this.deleteWithLink)})),0!==this.buttonToDeleteElement.length&&this.buttonToDeleteElement.forEach((e=>{e.addEventListener("click",this.deleteWithButton)}))}deleteWithLink(e){e.preventDefault(),e.stopPropagation();const t=e.currentTarget;this.displayOrHidePlural(t),r()(this.deleteElementModal).modal("show");const i=t.href,s=document.querySelectorAll(".animated-loader");this.deleteElementModal.querySelector("[data-delete-element-yes]").addEventListener("click",(()=>{window.location=i,s.forEach((e=>{re.A.showLoader(e)}))}))}deleteWithButton(e){e.preventDefault(),e.stopPropagation(),this.displayOrHidePlural(e.currentTarget),r()(this.deleteElementModal).modal("show");const t=document.querySelector(".delete-element-form"),i=document.querySelectorAll(".animated-loader");this.deleteElementModal.querySelector("[data-delete-element-yes]").addEventListener("click",(()=>{i.forEach((e=>{re.A.showLoader(e)})),t.submit()}))}displayOrHidePlural(e){const t=e.getAttribute("data-single-element"),i=e.getAttribute("data-multiple-element"),s=this.deleteElementModal.querySelectorAll(".single"),n=this.deleteElementModal.querySelectorAll(".multiple");null!==t&&(s.forEach((e=>{e.style.display="inline"})),n.forEach((e=>{e.style.display="none"}))),null!==i&&(s.forEach((e=>{e.style.display="none"})),n.forEach((e=>{e.style.display="inline"})))}serializeForm(e){let t=Array.from(new FormData(e),(e=>e.map((e=>e instanceof File?e.name+e.size:encodeURIComponent(e))).join("="))).join("&");return e.querySelectorAll(".ql-editor").forEach(((e,i)=>{const s=encodeURIComponent(e.innerText);t+="&quillElement-".concat(i,"=").concat(s)})),t}onPageLeave(e){if(!!Array.from(this.forms).every((e=>e.initialState===this.serializeForm(e))))return;e.preventDefault(),e.stopPropagation();const t=e.currentTarget.href;this.showConfirmationModal(t)}showConfirmationModal(e){const t=document.querySelectorAll(".animated-loader");t.forEach((e=>{re.A.hideLoader(e)})),r()(this.deleteElementModal).modal("show"),this.deleteElementModal.querySelector("[data-quit-form-yes]").addEventListener("click",(()=>{window.location=e,t.forEach((e=>{re.A.showLoader(e)}))}))}}class rt{constructor(){this.rows=document.querySelectorAll(".idea-clickable-row"),this.init()}init(){this.rows.forEach((e=>{e.addEventListener("click",(()=>{var t;const i=null===(t=e.getAttribute("data-url"))||void 0===t?void 0:t.trim();i&&(window.location.href=i)}))}))}}document.querySelectorAll("[data-generic-modal]").forEach((e=>{new V(e)})),document.querySelectorAll("[data-component-loader]").forEach((e=>{new H(e)}));const lt=document.getElementById("sign_content_editor");lt&&new _e(lt);const dt=document.getElementById("sign_title_editor");dt&&new pe(dt);const ct=document.getElementById("sign_cancelStatus");ct&&new d(ct,lt);const ht=document.querySelector("[data-target-toolbar]");ht&&new o(ht,document.getElementById(ht.getAttribute("data-target-toolbar")));const ut=document.querySelector("[data-graph-series]");if(ut){const e=new URL(window.location.href),t=e.searchParams.get("startDate"),i=e.searchParams.get("endDate");let s,n;t?s=new Date(t):""===ut.getAttribute("data-entity")?(s=new Date,s.setDate(s.getDate()-30)):s=new Date(ut.getAttribute("data-first-date")),i?n=new Date(i):(n=new Date,n.setDate(n.getDate()+1));const o=()=>p.setDates(s,n),a=document.getElementById("start-date-filter"),r=document.getElementById("end-date-filter"),l=document.getElementById("city-graph-filter"),d=document.getElementById("city-graph-reset-filter"),c=document.getElementById("city-graph-refresh"),h=document.getElementById("city-graph-total"),u=document.getElementById("no-views"),m=ut.hasAttribute("data-graph-favorite"),p=new C(ut,h,u,JSON.parse(ut.getAttribute("data-graph-series")),o,m);a.valueAsDate=new Date(s),r.valueAsDate=new Date(n),c.addEventListener("click",(()=>{document.location.reload()})),a.addEventListener("change",(t=>{s=new Date(t.target.value),e.searchParams.set("startDate",s),window.history.replaceState(null,null,"".concat(e.pathname,"?").concat(e.searchParams.toString()))})),r.addEventListener("change",(t=>{n=new Date(t.target.value),e.searchParams.set("endDate",n),window.history.replaceState(null,null,"".concat(e.pathname,"?").concat(e.searchParams.toString()))})),l.addEventListener("click",o),d.addEventListener("click",(()=>{a.valueAsDate=null,r.valueAsDate=null,window.history.replaceState(null,null,window.location.pathname)}))}const mt=document.querySelectorAll(".image-field");mt&&mt.forEach((e=>new G(e)));const pt=document.querySelectorAll(".password-field");pt&&pt.forEach((e=>new Oe(e)));const gt=document.querySelectorAll(".password-strength");gt&&gt.forEach((e=>new ce(e.parentElement)));const ft=document.querySelectorAll(".sign-files-field");ft&&ft.forEach((e=>new $(e)));const yt=document.querySelectorAll(".notifications-field");yt&&yt.forEach((e=>new Q(e))),Array.from(document.querySelectorAll(".datepicker:not([data-no-flatpickr])")).forEach((e=>(0,X.A)(e,{locale:Z.French,...JSON.parse(e.getAttribute("data-config"))})));const bt=document.querySelectorAll(".btn-confirm");bt&&bt.forEach((e=>new Fe(e))),document.querySelectorAll("form").forEach((e=>{new re.A(e,"submit")})),document.querySelectorAll("a.trigger-loader").forEach((e=>{new re.A(e,"click")}));const vt=document.querySelector(".user-entities-table");vt&&new O(vt),document.querySelectorAll("[data-announcement-type]").forEach((e=>new Pe(e))),r()("select[data-use-select2]").select2({width:"100%",matcher:he.A,minimumResultsForSearch:8});document.getElementById("client-directory-search")&&new N(document.getElementById("city-selector"),document.getElementById("country-selector"),document.getElementById("region-selector"),document.getElementById("department-selector"),document.getElementById("skill-selector"),document.getElementById("resident-selector"),document.getElementById("list-directory")),r()(".modal[data-show]").first().modal("show"),document.querySelectorAll(".duplicated-value").forEach((e=>{const t=parseInt(e.dataset.offset?e.dataset.offset:0,10),i=parseInt(e.dataset.length?e.dataset.length:0,10),s=document.getElementById(e.dataset.sourceInputId);new U(e,s,t,i)})),document.querySelectorAll("[data-copy]").forEach((e=>{new Ve.A(e,".sign-preview__actions")}));const wt=document.querySelector(".text-copy-btn");wt&&new ot(wt,document.querySelector("[data-text-copy]"));const St=document.querySelector(".batch-select");if(St){document.querySelector('button[name="batch_remove_legal_display_files[remove]"]')?new s(St,".batch-select-item",'button[name="batch_remove_legal_display_files[remove]"]',".legal-display-file-list"):new s(St,".batch-select-item",'button[name="batch_remove_signs[remove]"]',".sign-list")}document.querySelectorAll(".form-sign-display-fieldset").forEach((e=>{new He(e)}));const Et=document.querySelector("#broadcast-target");Et&&new n(Et),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(["[data-disable-entity-notifications-inputs]"]).forEach((e=>{const t=e.dataset.disableEntityNotificatonsDependentInputs.split(","),i=[];t.forEach((e=>{const t=document.getElementsByName(e);i.push(...t)})),new Ne(e,i)}));document.querySelectorAll(["[data-disable-token-diffusion-inputs]"]).forEach((e=>{const t=e.dataset.disableTokenDiffusionDependentInputs.split(","),i=[];t.forEach((e=>{const t=document.getElementsByName(e);i.push(...t)})),new Qe(e,i)}))})),document.querySelectorAll("form.export").forEach((e=>{new K(e)})),document.querySelectorAll(".animated-loader").forEach((e=>{e.classList.contains("animated-loader--show")&&window.addEventListener("load",(()=>re.A.hideLoader(e)))})),document.querySelectorAll(["[data-widget-container]"]).forEach((e=>{new ye(e)}));const At=document.querySelector("[data-fetch-url-reset-password]");At&&new Re(At),r()((function(){r()(".modal--force-show").modal("show")})),document.querySelectorAll("[data-container-field-searchable]").forEach((e=>{new z(e)})),document.querySelectorAll("[data-container-burger-menu]").forEach((e=>{new ge(e)}));const Lt=document.querySelector("[data-module-sortable]");Lt&&new le(Lt);const qt=document.querySelector('[data-id-modal="media-module"]');(qt||document.querySelector("[data-partner]"))&&new te(qt);document.querySelector("[data-module-form]")&&new ne;document.querySelector('[data-id-modal="modal-modele"]')&&new se,document.querySelectorAll(".disabled").forEach((e=>{new j(e)}));document.querySelector("#join_panneaupocket_plus_modal")&&new Ue;const Ct=document.querySelector("#broadcast-form-target");Ct&&new l(Ct);const xt=document.querySelector("#publication_date");xt&&new Ze(xt);const kt=document.querySelector("#module_lien_interne_entities");kt&&new ie(kt);document.querySelector(".module-betterstreet")&&new oe;document.querySelector("#module_submit_mail")&&new ae;const Mt=document.querySelector("#token_type");Mt&&new fe(Mt);document.querySelectorAll("#track-click").forEach((e=>{e.addEventListener("click",(()=>{window.open("https://www.panneaupocket.com/panneaupocket-plus/","_blank")}))}));const It=document.querySelector("a[aria-controls=to-review-signs]");if(It){new URLSearchParams(window.location.href.split("?")[1]).has("toReview")&&It.click()}const Dt=document.querySelector("#add_media_module_file");function Tt(e){const t=document.getElementById(e);t&&t.addEventListener("click",(()=>{window.location.href=t.getAttribute("data-url")}))}Dt&&new Ke(Dt),document.querySelectorAll("select[data-select2-entities]").forEach((e=>{e.getAttribute("data-select2-multiple")?new R.A(e,!0):new R.A(e,!1)})),Tt("widgetConfigButton"),Tt("widgetCancelListButton"),Tt("widgetCreateButton"),Tt("widgetCancelConfig");const Bt=document.getElementById("widget-color-primary");Bt&&new Ge(Bt);const _t=document.getElementById("open-sheet-modal"),Pt=document.getElementById("sheet-modal"),Ft=document.getElementById("ac-sheet"),Nt=document.getElementById("btn-sheet-closer");_t&&(_t.addEventListener("click",(()=>{Pt.style.display="flex"})),Nt.addEventListener("click",(e=>{e.stopPropagation(),Pt.style.display="none",Ft.src=Ft.dataset.defaultUrl;document.getElementById("sheet-title").textContent="Création d'une page annuaire"}))),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("module_annuaire_id_ac_fiche"),t=document.getElementById("idAcFicheArray"),i=document.getElementById("directory-listAC"),s=document.getElementById("ac-directory");e&&t&&new tt(e,t,Ft),i&&new it(s)}));const Rt=document.getElementById("sign_publish"),Ot=document.getElementById("sign_save");[Rt,document.getElementById("sign_renotify"),Ot].forEach((e=>{const t=document.querySelector(".error-text-empty");e&&e.addEventListener("click",(e=>{""===document.querySelector(".ql-editor").querySelector("p").innerText.trim()&&(e.preventDefault(),t.style.display="block")}))}));const Ht=document.getElementById("widget_config"),jt=document.getElementById("widget_iframe");Ht&&jt&&new et(Ht,jt);const Vt=document.getElementById("module_legacy_display_file_uploadedFile"),Ut=document.getElementById("btn-upload"),zt=document.getElementById("module_legacy_display_file_submit");Ut&&(Ut.addEventListener("click",(function(){Vt.click()})),Vt.addEventListener("change",(function(){if(Vt.files.length>0){const e=Vt.files[0].name;confirm('Vous avez sélectionné "'.concat(e,'". Voulez-vous continuer ?'))?zt.click():Vt.value=""}})));const Wt=document.querySelector("#sign_dayPeriodPublish"),$t=document.querySelector("#sign_startAt");Wt&&$t&&new je($t,Wt),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("upload-trigger-legacy"),t=document.querySelector('#hidden-upload-form input[type="file"]');e&&t&&(e.addEventListener("click",(function(){t.click()})),t.addEventListener("change",(function(){t.files.length>0&&(document.querySelectorAll(".animated-loader").forEach((e=>{re.A.showLoader(e)})),document.getElementById("hidden-upload-form").submit())})))}));const Jt=document.querySelector("#confirm-delete-modal");if(Jt){new at(document.querySelectorAll("a[data-delete-element]"),document.querySelectorAll("button[data-delete-element]"),Jt.getAttribute("data-element"))}document.addEventListener("DOMContentLoaded",(()=>{new rt}));const Yt=document.querySelectorAll("#module-phototheque-files-field");Yt&&Yt.forEach((e=>new Y(e))),document.addEventListener("DOMContentLoaded",(()=>{!function(){const e=document.querySelector("textarea.js-limit-200");if(!e)return;const t=parseInt(e.dataset.maxLength,10),i=document.createElement("div");i.classList.add("text-danger","mt-1"),i.textContent="Le contenu du message ne doit pas dépasser ".concat(t," caractères"),i.style.display="none",e.parentNode.appendChild(i),e.addEventListener("input",(()=>{i.style.display=e.value.length>=t?"block":"none"}))}()}))},4436:function(e,t,i){i.d(t,{A:function(){return a}});i(5458);var s=i(4692),n=i.n(s),o=i(2940);class a{constructor(e){this.element=e,this.country=null,this.onChange=this.onChange.bind(this),this.filter=this.filter.bind(this),this.load()}addEventListener(e,t){this.element.addEventListener(e,t)}load(){this.choices=n()(this.element).select2({allowClear:!0,matcher:this.filter,sorter:e=>e.sort(((e,t)=>e.text.localeCompare(t.text)))}),this.choices.on("change",this.onChange)}setCountry(e){if(this.country=e,this.country){const e=this.getCurrent();e&&this.getCountry(e)!==this.country&&this.clear()}}getCountry(e){return e.country||(e.country=e.element.getAttribute("data-country")),e.country}filter(e,t){return this.country&&this.country!==this.getCountry(t)?null:(0,o.A)(e,t)}onChange(){const e=this.getCurrent();if(!e)return void this.element.dispatchEvent(new CustomEvent("clear",{detail:{}}));const{id:t,text:i}=e;t?this.element.dispatchEvent(new CustomEvent("region",{detail:{id:t,label:i}})):this.element.dispatchEvent(new CustomEvent("clear",{detail:{}}))}getCurrent(){const e=this.choices.select2("data");return e.length&&e[0].id?e[0]:null}clear(){this.choices.val(null).trigger("change")}}},7856:function(e,t,i){e.exports=i.p+"images/logo-small.5ea87d10.svg"}},function(e){e.O(0,[552,439,165,660],(function(){return t=8859,e(e.s=t);var t}));e.O()}]);